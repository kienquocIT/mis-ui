{% extends 'base.html' %}
{% load static i18n %}
{% block cssHeader %}{% endblock %}

{% block pageContent %}
    <div class="accordion accordion-flush" id="accordionFlushExample">
        <div class="accordion-item">
            <h2 class="accordion-header" id="flush-headingOne">
                <button
                        class="accordion-button" type="button" data-bs-toggle="collapse"
                        data-bs-target="#flush-collapseUUID" aria-expanded="true" aria-controls="flush-collapseOne"
                >
                    <i class="fa-solid fa-wand-magic-sparkles mr-3"></i> UUID generate
                </button>
            </h2>
            <div
                    id="flush-collapseUUID" class="accordion-collapse collapse show" aria-labelledby="flush-headingOne"
                    data-bs-parent="#accordionFlushExample"
            >
                <div class="accordion-body">
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col">
                                <div class="form-group">
                                    <label for="selectVersionUUID" class="form-label">Version:</label>
                                    <select name="" id="selectVersionUUID" class="form-select">
                                        <option value="1">Version 1</option>
                                        <option value="4" selected>Version 4</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col">
                                <div class="form-group">
                                    <label for="selectTypeUUID4" class="form-label">Type Return:</label>
                                    <select name="" id="selectTypeUUID4" class="form-select">
                                        <option value="str" selected>String - have commas</option>
                                        <option value="hex">Hex - no commas</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col">
                                <div class="form-group">
                                    <label for="inputAmountUUID4" class="form-label">Amount UUID4</label>
                                    <div class="input-group mb-3">
                                        <input
                                                id="inputAmountUUID4"
                                                value="1"
                                                type="number" class="form-control" placeholder="Recipient's username"
                                                aria-label="Recipient's username"
                                                aria-describedby="button-addon2"
                                                min="1"
                                                max="500"
                                        >
                                        <button class="btn btn-primary" type="button" id="button-generate">
                                            Generate
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="form-group">
                                    <label for="dataUUIDGenerate" class="form-label">Result:</label>
                                    <ol id="dataUUIDGenerate" style="font-family: Consolas, monospace;"></ol>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="accordion-item">
            <h2 class="accordion-header" id="flush-headingTwo">
                <button
                        class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#flush-collapseTwo" aria-expanded="false" aria-controls="flush-collapseTwo"
                >
                    <i class="fa-solid fa-scissors mr-3"></i> Minimal UUID
                </button>
            </h2>
            <div
                    id="flush-collapseTwo" class="accordion-collapse collapse" aria-labelledby="flush-headingTwo"
                    data-bs-parent="#accordionFlushExample"
            >
                <div class="accordion-body">
                    <div class="input-group mb-3">
                        <button class="btn btn-outline-secondary" type="button" id="btnClearInputVal"><i class="fa-solid fa-xmark"></i></button>
                        <input
                                type="text" class="form-control" placeholder="UUID-4 paste here, Commas with multiple UUID"
                                aria-label="" aria-describedby="button-addon2"
                                id="inputConvertMinimalUUID"
                        >
                        <button class="btn btn-outline-secondary" type="button" id="btnConvertMinimalUUID">Convert
                        </button>
                    </div>
                    <div id="minimalUUIDResult"></div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block jsFooter %}
    <script>
        function generateUUID(ver = 4, str_or_hex = 'str') {
            let uid = null;
            if (ver === 4) {
                uid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
                    let r = Math.random() * 16 | 0,
                        v = c === 'x' ? r : (r & 0x3 | 0x8);
                    return v.toString(16);
                });
            }
            if (ver === 1) {
                uid = 'xxxxxxxx-xxxx-1xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
                    let r = Math.random() * 16 | 0,
                        v = c === 'x' ? r : (r & 0x3 | 0x8);
                    return v.toString(16);
                });
            }

            if (uid !== null) {
                if (str_or_hex === 'hex') {
                    return uid.replaceAll("-", "");
                }
                return uid;
            }
            throw Error('Version not support');
        }

        function copyText() {
            let copyText = document.getElementById("copyText");

            // Chọn toàn bộ nội dung trong input
            copyText.select();
            copyText.setSelectionRange(0, 99999); // Hỗ trợ cho một số trình duyệt di động

            // Copy nội dung vào clipboard
            document.execCommand("copy");

            // Thông báo hoặc thay đổi trạng thái nút copy
            let copyButton = document.getElementById("copyButton");
            copyButton.innerHTML = "Copied!";
        }

        $('#button-generate').click(function (event) {
            event.preventDefault();
            let dataEle = $('#dataUUIDGenerate');
            dataEle.empty();

            let amount = Number.parseInt($('#inputAmountUUID4').val());
            let versionUUID = Number.parseInt($('#selectVersionUUID').val());
            let typeRs = $('#selectTypeUUID4').val();
            if (
                amount && Number.isInteger(amount) &&
                typeRs && (typeRs === 'str' || typeRs === 'hex') &&
                versionUUID && Number.isInteger(versionUUID) && (versionUUID === 1 || versionUUID === 4)
            ) {
                let btnCopy = `<button class="btn btn-icon btn-rounded bg-dark-hover btnCopy"><span class="icon"><i class="fa-solid fa-copy"></i></span></button>`;
                for (let i = 0; i < amount; i++) {
                    let tmp = generateUUID(versionUUID, typeRs);
                    dataEle.append(
                        `<li><span class="dataValueUUID mr-1">${tmp}</span>${btnCopy}</li>`
                    )
                }
            }
        });

        $(document).on('click', '.btnCopy', function (event) {
            let dataCopy = $(this).prev('.dataValueUUID').text();
            navigator.clipboard.writeText(dataCopy);

            if ($(this).next('.msgCopied').length > 0) {
                $(this).next('.msgCopied').remove();
            }
            let eleCopied = $(`<span class="msgCopied text-muted">Copied!</span>`);
            eleCopied.insertAfter($(this));
            setTimeout(
                () => {
                    eleCopied.remove();
                },
                5000
            )
        });

        let minimalUUIDInput = $('#inputConvertMinimalUUID');
        let minimalUUIDResult = $('#minimalUUIDResult');

        function replaceUUIDToMinimal() {
            let data = minimalUUIDInput.val();
            if (data){
                let arr = data.split(",");
                let result = [];
                arr.map(
                    (item)=>{
                        result.push(
                            item.replaceAll("-", "").replaceAll(" ", "")
                        )
                    }
                )
                minimalUUIDResult.html(
                    `<ol>` +
                    result.map(
                        (item)=>{return `<li>${item}</li>`}
                    ).join("") +
                    `</ol>`
                );
            } else {
                minimalUUIDResult.empty();
            }
        }

        $('#btnClearInputVal').click(function (event){
            minimalUUIDInput.val("");
        })
        $('#btnConvertMinimalUUID').click(function (event) {
            replaceUUIDToMinimal();
        });
        minimalUUIDInput.on('keypress', function (e) {
            if (e.which === 13) {
                replaceUUIDToMinimal();
            }
        });
    </script>

{% endblock %}