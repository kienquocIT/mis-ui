{% extends 'base.html' %}
{% load i18n %}
{% load static %}
{% block title %}{% trans 'Hướng dẫn Cấu hình Hạch toán Tự động' %}{% endblock %}
{% block cssHeader %}
<style>
    /* Style hỗ trợ nội dung bên trong */
    .menu-box {
        border-left: 4px solid #007bff;
        background: #f8f9fa;
        padding: 15px;
        margin-bottom: 15px;
        border-radius: 4px;
    }
    .menu-title {
        font-weight: bold;
        color: #343a40;
        display: flex;
        align-items: center;
    }
    .menu-icon {
        width: 24px;
        text-align: center;
        margin-right: 10px;
        color: #6c757d;
    }
    .action-label {
        text-transform: uppercase;
        font-weight: bold;
        color: #6c757d;
        background: #e9ecef;
        padding: 2px 6px;
        border-radius: 3px;
        margin-right: 5px;
    }
    .example-block {
        background-color: #fff;
        border: 1px dashed #ced4da;
        padding: 10px;
        border-radius: 4px;
        margin-top: 8px;
    }
</style>
{% endblock %}
{% block pageContent %}
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h3 class="text-dark font-weight-bold mb-0">{% trans 'Cẩm nang Hạch toán Tự động' %}</h3>
                    <p class="text-muted mb-0">{% trans 'Hướng dẫn thiết lập theo trình tự Menu chức năng.' %}</p>
                </div>
            </div>

            <ul class="nav nav-pills-bfl mb-4" id="guideTabs" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" data-bs-toggle="tab" href="#tab_overview" role="tab" aria-selected="true">
                        <span class="nav-link-text">{% trans '1. Khởi động' %}</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-bs-toggle="tab" href="#tab_setup" role="tab" aria-selected="false">
                        <span class="nav-link-text">{% trans '2. Thiết lập Dữ liệu (Lookup)' %}</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-bs-toggle="tab" href="#tab_rules" role="tab" aria-selected="false">
                        <span class="nav-link-text">{% trans '3. Cấu hình Quy tắc (Rules)' %}</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-bs-toggle="tab" href="#tab_result" role="tab" aria-selected="false">
                        <span class="nav-link-text">{% trans '4. Vận hành' %}</span>
                    </a>
                </li>
            </ul>

            <div class="tab-content" id="guideTabsContent">

                <div class="tab-pane fade show active" id="tab_overview" role="tabpanel">
                    <div class="py-2">
                        <h5 class="font-weight-bold text-primary mb-3">{% trans 'Bước khởi đầu: Kích hoạt Hệ thống' %}</h5>
                        <p>{% trans 'Đầu tiên, bạn cần quyết định nghiệp vụ nào sẽ được tự động hóa.' %}</p>
                        <hr>

                        <div class="menu-box">
                            <div class="menu-title mb-2">
                                <span class="menu-icon"><i class="fa-solid fa-infinity"></i></span>
                                {% trans '1. Loại chứng từ hạch toán (JE Document Type)' %}
                            </div>
                            <div class="pl-4 ml-1">
                                <p class="mb-2">{% trans 'Đây là công tắc tổng. Nếu tắt, hệ thống sẽ không chạy cho nghiệp vụ đó.' %}</p>
                                <div class="mb-1">
                                    <span class="action-label">{% trans 'HÀNH ĐỘNG' %}</span>
                                    <span class="small">{% trans 'Tìm mã (VD: DO_SALE) và bật' %} <strong class="text-success">Active</strong>.</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-pane fade" id="tab_setup" role="tabpanel">
                    <h5 class="font-weight-bold text-primary mb-3">{% trans 'Dạy cho máy hiểu về Dữ liệu (Chế độ LOOKUP)' %}</h5>
                    <p class="text-muted mb-4">{% trans 'Nếu bạn muốn hạch toán ĐỘNG (Ví dụ: Bán Laptop vào TK 1561, bán Ghế vào TK 155), bạn BẮT BUỘC phải làm 3 bước dưới đây trước khi cài đặt quy tắc.' %}</p>

                    <div class="menu-box" style="border-color: #17a2b8;">
                        <div class="menu-title mb-2">
                            <span class="menu-icon"><i class="fa-solid fa-layer-group"></i></span>
                            {% trans '2. Nhóm định khoản (JE Posting Group)' %}
                        </div>
                        <div class="pl-4 ml-1">
                            <p class="mb-2">{% trans 'Tạo ra các "Nhóm" để phân loại đối tượng. Bạn cần tạo nhóm trước khi gán.' %}</p>
                            <div class="example-block">
                                <strong>{% trans 'Ví dụ cần tạo:' %}</strong>
                                <ul class="mb-0 pl-3">
                                    <li>{% trans 'Nhóm Hàng hóa (Dùng cho hàng mua đi bán lại)' %}</li>
                                    <li>{% trans 'Nhóm Thành phẩm (Dùng cho hàng tự sản xuất)' %}</li>
                                    <li>{% trans 'Nhóm Khách lẻ (Dùng cho khách không thường xuyên)' %}</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="menu-box" style="border-color: #17a2b8;">
                        <div class="menu-title mb-2">
                            <span class="menu-icon"><i class="fa-solid fa-plug"></i></span>
                            {% trans '3. Gán nhóm định khoản (JE Group Assignment)' %}
                        </div>
                        <div class="pl-4 ml-1">
                            <p class="mb-2">{% trans 'Chỉ định: Sản phẩm nào thuộc Nhóm nào?' %}</p>
                            <div class="example-block">
                                <span class="action-label">{% trans 'THAO TÁC' %}</span>
                                {% trans 'Vào chi tiết sản phẩm "Laptop Dell" -> Tại ô Nhóm Định Khoản, chọn "Nhóm Hàng hóa".' %} <br>
                                <span class="text-muted font-italic">{% trans '(Tương tự: Chọn "Ghế Gỗ" -> Gán vào "Thành phẩm")' %}</span>
                            </div>
                        </div>
                    </div>

                    <div class="menu-box" style="border-color: #17a2b8;">
                        <div class="menu-title mb-2">
                            <span class="menu-icon"><i class="fa-solid fa-share-alt"></i></span>
                            {% trans '4. Thiết lập tài khoản kế toán (JE GL Mapping)' %}
                        </div>
                        <div class="pl-4 ml-1">
                            <p class="mb-2">{% trans 'Đây là "Cuốn từ điển". Bạn quy định tài khoản cho từng Vai trò trong Nhóm.' %}</p>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="bg-white border p-2 rounded">
                                        <strong class="text-info">{% trans 'Với Nhóm Hàng Hóa:' %}</strong>
                                        <ul class="mb-0 pl-3 mt-1">
                                            <li>{% trans 'Vai trò KHO (ASSET) = 1561' %}</li>
                                            <li>{% trans 'Vai trò GIÁ VỐN (COGS) = 632' %}</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="bg-white border p-2 rounded">
                                        <strong class="text-success">{% trans 'Với Nhóm Thành Phẩm:' %}</strong>
                                        <ul class="mb-0 pl-3 mt-1">
                                            <li>{% trans 'Vai trò KHO (ASSET) = 155' %}</li>
                                            <li>{% trans 'Vai trò GIÁ VỐN (COGS) = 632' %}</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-pane fade" id="tab_rules" role="tabpanel">
                    <h5 class="font-weight-bold text-primary mb-3">{% trans 'Lắp ghép Quy tắc (Menu: JE Posting Rule)' %}</h5>

                    <div class="menu-box" style="border-color: #fd7e14;">
                        <div class="menu-title mb-3">
                            <span class="menu-icon"><i class="fa-solid fa-tools"></i></span>
                            {% trans 'Cách thiết lập cho từng trường hợp' %}
                        </div>

                        <div class="card mb-3 border-secondary">
                            <div class="card-header bg-light font-weight-bold text-secondary">
                                {% trans 'TRƯỜNG HỢP 1: CỐ ĐỊNH (FIXED)' %}
                            </div>
                            <div class="card-body py-2 px-3">
                                <p class="mb-2">{% trans 'Dùng cho các tài khoản "Bất di bất dịch" (Tiền mặt, Thuế, Tài khoản trung gian...).' %}</p>
                                <div class="bg-white border p-2 rounded">
                                    <strong>{% trans 'Ví dụ: Cấu hình dòng Thuế đầu vào (1331)' %}</strong>
                                    <ul class="mb-0 pl-3 mt-1">
                                        <li>{% trans 'Account Source Type:' %} <strong class="text-success">FIXED</strong></li>
                                        <li>{% trans 'Role Key:' %} <em>{% trans '(Để trống hoặc chọn TAX_IN để tham khảo)' %}</em></li>
                                        <li>{% trans 'Fixed Account:' %} <strong class="text-danger">Chọn 1331</strong></li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="card mb-3 border-primary">
                            <div class="card-header bg-light font-weight-bold text-primary">
                                {% trans 'TRƯỜNG HỢP 2: ĐỘNG (LOOKUP)' %}
                            </div>
                            <div class="card-body py-2 px-3">
                                <p class="mb-2">{% trans 'Dùng khi bạn muốn máy tự tìm tài khoản dựa trên Nhóm sản phẩm (đã cài ở Tab 2).' %}</p>
                                <div class="bg-white border p-2 rounded">
                                    <strong>{% trans 'Ví dụ: Cấu hình dòng Giảm Kho khi xuất hàng' %}</strong>
                                    <ul class="mb-0 pl-3 mt-1">
                                        <li>{% trans 'Account Source Type:' %} <strong class="text-primary">LOOKUP</strong></li>
                                        <li>{% trans 'Role Key:' %} <strong class="text-danger">ASSET (Kho)</strong></li>
                                        <li>{% trans 'Fixed Account:' %} <em>{% trans '(Để trống - Máy sẽ tự tìm)' %}</em></li>
                                    </ul>
                                    <div class="mt-2 text-muted font-italic">
                                        <i class="fa-solid fa-robot"></i> {% trans 'Máy sẽ hiểu: "À, đây là dòng LOOKUP với vai trò ASSET. Sản phẩm này thuộc nhóm Hàng hóa -> Vậy tôi sẽ lấy tài khoản 1561 mà bạn đã map ở bước trước."' %}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <hr>
                        <p class="mb-3 font-weight-bold">{% trans 'Ngoài ra, đừng quên trả lời 2 câu hỏi còn lại:' %}</p>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="card h-100 border bg-white p-3">
                                    <strong class="text-dark">1. Lấy tiền nào? (Amount Source)</strong>
                                    <ul class="mb-0 pl-3 mt-1 text-muted">
                                        <li><strong>HEADER:</strong> {% trans 'Tổng cộng (VD: Tổng phải trả)' %}</li>
                                        <li><strong>LINE:</strong> {% trans 'Chi tiết (VD: Giá vốn từng cái)' %}</li>
                                    </ul>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card h-100 border bg-white p-3">
                                    <strong class="text-dark">2. Ghi bên nào? (Side)</strong>
                                    <div class="mt-2">
                                        <span class="badge badge-secondary">DEBIT (Nợ)</span>
                                        <span class="badge badge-secondary">CREDIT (Có)</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-pane fade" id="tab_result" role="tabpanel">
                    <h5 class="font-weight-bold text-primary mb-3">{% trans 'Vận hành & Kiểm tra' %}</h5>

                    <div class="menu-box" style="border-color: #28a745;">
                        <div class="menu-title mb-2">
                            <span class="menu-icon"><i class="fa-solid fa-list-check"></i></span>
                            {% trans '6. Danh sách bút toán (Journal Entry List)' %}
                        </div>
                        <div class="pl-4 ml-1">
                            <p class="mb-2">{% trans 'Nơi lưu trữ kết quả cuối cùng. Khi bạn duyệt phiếu, bút toán sẽ hiện ở đây.' %}</p>

                            <div class="bg-white border p-3 rounded">
                                <strong class="text-success mb-2 d-block">{% trans 'VÍ DỤ KẾT QUẢ (Khi xuất kho 1 Laptop):' %}</strong>
                                <table class="table table-sm table-borderless mb-0">
                                    <tr>
                                        <td width="20%">Nợ 632</td>
                                        <td width="20%" class="text-right">10.000.000</td>
                                        <td class="text-muted font-italic">{% trans '(Giá vốn - Lấy từ LOOKUP COGS)' %}</td>
                                    </tr>
                                    <tr>
                                        <td>Có 1561</td>
                                        <td class="text-right">10.000.000</td>
                                        <td class="text-muted font-italic">{% trans '(Giảm kho - Lấy từ LOOKUP ASSET)' %}</td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}