{% load i18n %}

<!-- Currency Rates Modal -->
<div class="modal fade" id="modal-exchange-rate" tabindex="-1" role="dialog" aria-labelledby="modal-exchange-rate">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">{% trans "Exchange Rate" %}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-body" style="max-height: 70vh; overflow: auto">
                <div class="nicescroll-bar">
                    <button type="button" class="btn btn-xs btn-success" id="btn-reload-currency-rate">
                        {% trans 'Refresh' %}
                    </button>
                    <table class="table nowrap w-100" id="modal-table-exchange-rate"
                           data-url="{% url 'CurrencyListAPI' %}">
                        <thead>
                        <tr class="bg-light">
                            <th></th>
                            <th>{% trans 'Code' %}</th>
                            <th>{% trans 'Name' %}</th>
                            <th>{% trans 'Rate' %}</th>
                        </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{% trans 'Close' %}</button>
                <button type="button" id="btn-save-exchange-rate" class="btn btn-primary" data-bs-dismiss="modal">
                    {% trans 'Save' %}
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Select Product Modal -->
<div class="modal fade" id="modal-product" tabindex="-1" role="dialog" aria-labelledby="modal-product">
    <div class="modal-dialog modal-lg" style="min-width: 70%" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">{% trans "Select Product/Service" %}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-body" style="max-height: 70vh; overflow: auto">
                <div class="row">
                    <div class="col-12">
                        <table class="table nowrap w-100" id="modal-table-product"
                               data-url="{% url 'ProductListAPI' %}">
                            <thead>
                            <tr class="bg-secondary-light-5">
                                <th style="min-width: 30px"></th>
                                <th style="min-width: 30px"></th>
                                <th style="min-width: 250px">{% trans 'Product/Service' %}</th>
                                <th style="min-width: 250px">{% trans 'Description' %}</th>
                            </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{% trans 'Close' %}</button>
                <button type="button" id="btn-save-product" class="btn btn-primary"
                        data-bs-dismiss="modal">{% trans 'Save' %}</button>
            </div>
        </div>
    </div>
</div>

<!-- Add Container Modal -->
<div class="modal fade" id="modal_container" tabindex="-1" role="dialog" aria-labelledby="modal_container"
     aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">{% trans "Add container" %}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" style="overflow: auto; max-height: 80vh">
                <div class="row">
                    <div class="col-12">
                        <div class="form-group">
                            <label class="form-label required" for="container_name">{% trans 'Container name' %}</label>
                            <input type="text" class="form-control" name="container_name" id="container_name" required>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="form-group">
                            <label class="form-label" for="container_type">{% trans 'Container type' %}</label>
                            <select class="form-select select2" id="container_type"
                                    data-url="{% url 'ContainerMasterDataListAPI' %}"
                                    name="container_type">
                            </select>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="form-group">
                            <label class="form-label required" for="txt_title">{% trans 'Reference number' %}</label>
                            <input type="text" class="form-control" name="container_ref_number"
                                   id="container_ref_number" required>
                        </div>
                    </div>
                    <div class="col-12 col-md-6 col-lg-6">
                        <div class="form-group">
                            <label class="form-label" for="weight_input">{% trans 'Weight' %}</label>
                            <div class="input-group">
                                <input type="number" class="form-control" id="container_weight"
                                       name="weight" placeholder="0" step="0.1" min="0">
                                <span class="input-group-text">Kg</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-md-6 col-lg-6">
                        <div class="form-group">
                            <label class="form-label" for="dimension_input">{% trans 'Dimension' %}</label>
                            <div class="input-group">
                                <input type="number" class="form-control" id="container_dimension"
                                       name="dimension" placeholder="0" step="0.5" min="0">
                                <span class="input-group-text">M³</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-12">
                        <label for="container_note" class="form-label">{% trans 'Note' %}</label>
                        <textarea name="container_note" class="form-control" id="container_note" rows="2"></textarea>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{% trans 'Close' %}</button>
                <button type="button" id="btn_apply_container" class="btn btn-primary">{% trans 'Save' %}</button>
            </div>
        </div>
    </div>
</div>

<!-- Add Package Modal -->
<div class="modal fade" id="modal_package" tabindex="-1" role="dialog" aria-labelledby="modal_package"
     aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">{% trans "Add package" %}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" style="overflow: auto; max-height: 80vh">
                <div class="row">
                    <div class="col-12">
                        <div class="form-group">
                            <label class="form-label required" for="package_name">{% trans 'Package name' %}</label>
                            <input type="text" class="form-control" name="package_name" id="package_name" required>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="form-group">
                            <label class="form-label" for="package_type">{% trans 'Package type' %}</label>
                            <select class="form-select select2" id="package_type"
                                    data-url="{% url 'PackageMasterDataListAPI' %}" name="package_type">
                            </select>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="form-group">
                            <label for="package_container" class="form-label">{% trans 'Container' %}</label>
                            <select name="package_container" class="form-select" id="package_container"></select>
                        </div>
                    </div>

                    <div class="col-12">
                        <div class="form-group">
                            <label class="form-label" for="package_ref_number">{% trans 'Reference number' %}</label>
                            <input type="text" class="form-control" name="package_ref_number" id="package_ref_number">
                        </div>
                    </div>
                    <div class="col-12 col-md-6 col-lg-6">
                        <div class="form-group">
                            <label class="form-label" for="package_weight">{% trans 'Weight' %}</label>
                            <div class="input-group">
                                <input type="number" class="form-control" id="package_weight"
                                       name="package_weight" placeholder="0" step="0.1" min="0">
                                <span class="input-group-text">Kg</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-md-6 col-lg-6">
                        <div class="form-group">
                            <label class="form-label" for="package_dimension">{% trans 'Dimension' %}</label>
                            <div class="input-group">
                                <input type="number" class="form-control" id="package_dimension"
                                       name="package_dimension" placeholder="0" step="0.5" min="0">
                                <span class="input-group-text">M³</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-12">
                        <label for="package_note" class="form-label">{% trans 'Note' %}</label>
                        <textarea name="package_note" class="form-control" id="package_note" rows="2"></textarea>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{% trans 'Close' %}</button>
                <button type="button" id="btn_apply_package" class="btn btn-primary">{% trans 'Save' %}</button>
            </div>
        </div>
    </div>
</div>

<!-- Work Cost Modal -->
<div class="modal fade" id="modal-work-order-cost" tabindex="-1" role="dialog" aria-labelledby="modal-work-order-cost"
     data-bs-backdrop="static">
    <div class="modal-dialog modal-dialog-centered modal-lg" style="min-width: 95%" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">{% trans "Work Cost" %}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-body" style="max-height: 70vh; overflow: auto">
                <div class="nicescroll-bar">
                    <div class="row">
                        <div class="col-12">
                            <table class="table nowrap w-100" id="modal-table-work-order-cost">
                                <thead class="bg-secondary-light-5">
                                <tr>
                                    <th style="min-width: 40px"></th>
                                    <th style="min-width: 40px">{% trans 'Order' %}</th>
                                    <th style="min-width: 200px">{% trans 'Title' %}</th>
                                    <th style="min-width: 160px">{% trans 'Description' %}</th>
                                    <th style="min-width: 160px">{% trans 'Expense Item' %}</th>
                                    <th style="min-width: 80px">{% trans 'Quantity' %}</th>
                                    <th style="min-width: 160px">{% trans 'Unit Cost' %}</th>
                                    <th style="min-width: 80px">{% trans 'Currency' %}</th>
                                    <th style="min-width: 80px">{% trans 'Tax' %}</th>
                                    <th style="min-width: 160px">{% trans 'Total Amount' %}</th>
                                    <th style="min-width: 160px">{% trans 'Total' %}</th>
                                    <th style="min-width: 80px"></th>
                                </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>

                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    {% trans 'Close' %}
                </button>
                <button type="button" id="btn-save-work-order-cost" class="btn btn-primary" data-bs-dismiss="modal">
                    {% trans 'Save' %}
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Product Contribution Modal -->
<div class="modal fade" id="modal-product-contribution" tabindex="-1" role="dialog"
     aria-labelledby="modal-product-contribution" data-bs-backdrop="static">
    <div class="modal-dialog modal-xl" role="document" style="min-width: 85%">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">{% trans "Contribution of Product/Service" %}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-body" style="max-height: 70vh; overflow: auto">
                <b class="text-primary"><i class="fa-solid fa-thumbtack"></i> {% trans "Work" %}: </b><span
                    class="work-order-description"></span>
                <div class="nicescroll-bar">
                    <table class="table nowrap w-100" id="modal-table-product-contribution">
                        <thead class="bg-secondary-light-5">
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    {% trans 'Close' %}
                </button>
                <button type="button" id="btn-save-product-contribution" class="btn btn-primary"
                        data-bs-dismiss="modal">
                    {% trans 'Save' %}
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Payment Detail Modal -->
<div class="modal fade" id="modal-payment-detail" tabindex="-1" role="dialog" aria-labelledby="modal-payment-detail"
     data-bs-backdrop="static">
    <div class="modal-dialog modal-dialog-centered modal-lg" style="min-width: 95%" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">{% trans "Payment Detail" %}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-body" style="max-height: 70vh; overflow: auto">
                <div class="nicescroll-bar">
                    <table class="table nowrap w-100 min-w-1200p" id="modal-table-payment-detail">
                        <thead class="bg-secondary-light-5"></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{% trans 'Close' %}</button>
                <button type="button" id="btn-save-payment" class="btn btn-primary"
                        data-bs-dismiss="modal">{% trans 'Save' %}</button>
            </div>
        </div>
    </div>
</div>

<!-- Payment Detail without Invoice Modal -->
<div class="modal fade" id="modal-payment-detail-no-invoice" tabindex="-1" role="dialog"
     aria-labelledby="modal-payment-detail-no-invoice" data-bs-backdrop="static">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">{% trans "Payment Detail Without Invoice" %}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-body" style="max-height: 70vh; overflow: auto">
                <div class="nicescroll-bar">
                    <table class="table nowrap w-100" id="modal-table-payment-detail-no-invoice">
                        <thead class="bg-secondary-light-5">
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    {% trans 'Close' %}
                </button>
                <button type="button" id="btn-save-payment-no-invoice" class="btn btn-primary" data-bs-dismiss="modal">
                    {% trans 'Save' %}
                </button>
            </div>
        </div>
    </div>
</div>

<!--Advance Payment Modal -->
<div class="modal fade" id="modal-payment-reconcile" tabindex="-1" role="dialog"
     aria-labelledby="modal-payment-reconcile" data-bs-backdrop="static">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">{% trans "Advance payment without invoice before" %}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-body" style="max-height: 70vh; overflow: auto">
                <div class="nicescroll-bar">
                    <table class="table nowrap w-100" id="modal-table-payment-reconcile">
                        <thead class="bg-secondary-light-5"></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{% trans 'Close' %}</button>
                <button type="button" id="btn-save-payment-reconcile" class="btn btn-primary" data-bs-dismiss="modal">
                    {% trans 'Save' %}
                </button>
            </div>
        </div>
    </div>
</div>

<!--Select Transportion Modal-->
<div class="modal fade" id="modal-contribution-package" tabindex="-1" role="dialog"
     aria-labelledby="modal-contribution-package" data-bs-backdrop="static">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">{% trans "Select transported items" %}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-body" style="max-height: 70vh; overflow: auto">
                <div class="nicescroll-bar">
                    <table class="table nowrap w-100" id="modal-table-contribution-package">
                        <thead class="bg-secondary-light-5"></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{% trans 'Close' %}</button>
                <button type="button" id="btn-save-contribution-package" class="btn btn-primary"
                        data-bs-dismiss="modal">
                    {% trans 'Save' %}
                </button>
            </div>
        </div>
    </div>
</div>

<!--Delivery Work Modal-->
<div class="modal fade" id="deliveryInfoModalCenter" tabindex="-1"
     role="dialog" aria-labelledby="deliveryInfoModalCenter" aria-hidden="true">
    <div class="modal-dialog modal-xl" style="min-width: 80%" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">{% trans "Select Work with Delivery" %}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" style="overflow: auto; max-height: 80vh">
                <b class="target-code text-primary"></b>
                <div class="row">
                    <div class="col-12 col-md-6 col-lg-6 border-right">
                        <div class="row">
                            <div class="col-12">
                                <table id="delivery_work_order_list" class="table nowrap w-100 mb-5" data-method="GET"
                                       data-url="{% url 'SVOWorkOrderDetailAPI' %}">
                                    <thead>
                                    <tr>
                                        <th style="min-width: 50px"></th>
                                        <th style="min-width: 50px"></th>
                                        <th style="min-width: 250px">{% trans "Work" %}</th>
                                        <th style="min-width: 150px">{% trans "Start Date" %}</th>
                                        <th style="min-width: 150px">{% trans "End Date" %}</th>
                                    </tr>
                                    </thead>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-md-6 col-lg-6">
                        <div class="row">
                            <div class="col-12">
                                <table id="total_delivery_product" class="table nowrap w-100 mb-5">
                                    <thead>
                                    <tr>
                                        <th style="min-width: 50px"></th>
                                        <th style="min-width: 250px">{% trans "Product" %}</th>
                                        <th style="min-width: 150px">{% trans "No. of service delivered" %}</th>
                                    </tr>
                                    </thead>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{% trans 'Close' %}</button>
                <button type="button" id="btn-delivery" class="btn btn-primary"
                        data-bs-dismiss="modal">{% trans 'Save' %}
                </button>
            </div>
        </div>
    </div>
</div>


<div
        class="modal fade" id="deliveryLogModal" tabindex="-1"
        role="dialog" aria-labelledby="deliveryLogModal"
>
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><b>{% trans 'Delivery logs' %}</b></h5>
                <button type="button" class="btn btn-icon btn-rounded btn-flush-light flush-soft-hover btn-lg"
                        data-bs-dismiss="modal"><span class="icon"><i class="far fa-window-close"></i></span></button>
            </div>
            <div class="modal-body"></div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{% trans 'Close' %}</button>
            </div>
        </div>
    </div>
</div>

<!-- Version Comparison Offcanvas -->
<div class="offcanvas offcanvas-end w-100" tabindex="-1" id="versionCompareCanvas"
     aria-labelledby="versionCompareCanvasLabel">
    <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="versionCompareCanvasLabel"><b>{% trans 'Compare Version' %}</b></h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
        <div class="form-group mb-3">
            <label for="version-select" class="form-label">{% trans 'Select Version to Compare' %}</label>
            <select data-url="{% url 'ServiceOrderListAPI' %}" data-method="GET" data-keyResp="service_order_list"
                    class="form-select select2" id="version-select" name="version_to_compare">
            </select>
        </div>
        <div id="diffSummary" class="alert alert-info mb-3" style="display: none;">
            <h6 class="alert-heading"><i class="fas fa-chart-bar"></i> Comparison Summary</h6>
            <div class="row">
                <div class="col-3">
                    <div class="text-center">
                        <div class="h4 mb-0 text-primary" id="totalChanges">0</div>
                        <small class="text-muted">Total Changes</small>
                    </div>
                </div>
                <div class="col-3">
                    <div class="text-center">
                        <div class="h4 mb-0 text-warning" id="valuesChanged">0</div>
                        <small class="text-muted">Values Changed</small>
                    </div>
                </div>
                <div class="col-3">
                    <div class="text-center">
                        <div class="h4 mb-0 text-success" id="itemsAdded">0</div>
                        <small class="text-muted">Items Added</small>
                    </div>
                </div>
                <div class="col-3">
                    <div class="text-center">
                        <div class="h4 mb-0 text-danger" id="itemsRemoved">0</div>
                        <small class="text-muted">Items Removed</small>
                    </div>
                </div>
            </div>
        </div>
        <div class="row mt-5">
            <div class="col-12">
                <!-- tabs navigation -->
                <ul class="nav nav-pills-bfl" id="version-compare-tabs">
                    <li class="nav-item">
                        <a class="nav-link active" data-bs-toggle="tab" href="#tab-compare-all">
                            <span class="nav-link-text">{% trans 'All' %}</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-bs-toggle="tab" href="#tab-compare-service-detail">
                            <span class="nav-link-text">{% trans 'Service Detail' %}</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-bs-toggle="tab" href="#tab-compare-work-order">
                            <span class="nav-link-text">{% trans 'Work' %}</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-bs-toggle="tab" href="#tab-compare-expense">
                            <span class="nav-link-text">{% trans 'Expense' %}</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-bs-toggle="tab" href="#tab-compare-payment">
                            <span class="nav-link-text">{% trans 'Payment' %}</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-bs-toggle="tab" href="#tab-compare-attachment">
                            <span class="nav-link-text">{% trans 'Attachment' %}</span>
                        </a>
                    </li>
                </ul>
                <!-- tabs content -->
                <div class="tab-content" id="version-compare-tabs-content">
                    <div class="tab-pane fade show active" id="tab-compare-all">
                        <div id="compare-all-content"></div>
                    </div>
                    <div class="tab-pane fade" id="tab-compare-service-detail">
                        <div id="compare-service-detail-content"></div>
                    </div>
                    <div class="tab-pane fade" id="tab-compare-work-order">
                        <div id="compare-work-order-content"></div>
                    </div>
                    <div class="tab-pane fade" id="tab-compare-expense">
                        <div id="compare-expense-content"></div>
                    </div>
                    <div class="tab-pane fade" id="tab-compare-payment">
                        <div id="compare-payment-content"></div>
                    </div>
                    <div class="tab-pane fade" id="tab-compare-attachment">
                        <div id="compare-attachment-content"></div>
                    </div>
                </div>
            </div>
        </div>
        <div id="diffContainer" style="display: none;">

            <!-- Content will be dynamically inserted here -->
        </div>
    </div>
</div>