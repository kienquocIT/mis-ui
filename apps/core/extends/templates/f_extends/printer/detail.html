{% extends 'base.html' %}
{% load i18n static %}
{% block title %}{% trans 'Print Template' %} &#8901; {% trans 'Detail' %}{% endblock %}
{% block pageAction %}
    <a href="{% url 'PrintTemplateUpdateView' pk=pk %}">
        <button class="btn btn-outline-primary">
        <span>
            <span>{% trans 'Edit' %}</span>
            <span class="icon">
                <i class="fa-regular fa-pen-to-square"></i>
            </span>
        </span>
        </button>
    </a>
{% endblock %}

{% block pageContent %}
    <form
            id="frm-detail-print-template"
            data-url="{% url 'PrintTemplateDetailAPI' pk=pk %}"
    >
        <div class="row mb-3">
            <div class="col-12">
                <label class="form-label" for="inp-application">
                    {% trans 'Application' %}
                </label>
                <select
                        id="inp-application"
                        name="application"
                        class="select2 form-select"
                        data-url="{% url 'TenantApplicationListAPI' %}"
                        data-method="GET"
                        data-keyResp="tenant_application_list"
                        disabled
                ></select>
            </div>
        </div>
        <div class="row mb-3">
            <div class="col-12">
                <label class="form-label" for="inp-title">
                    {% trans 'Title' %}
                </label>
                <input
                        id="inp-title"
                        type="text"
                        name="title"
                        class="form-control" disabled
                >
            </div>
        </div>
        <div class="row mb-3">
            <div class="col-12">
                <label class="form-label" for="inp-remarks">
                    {% trans 'Description' %}
                </label>
                <textarea
                        id="inp-remarks"
                        type="text"
                        name="remarks"
                        class="form-control"
                        disabled
                ></textarea>
            </div>
        </div>
        <div class="row mb-3">
            <div class="col-12">
                <div class="form-check form-switch">
                    <input type="checkbox" class="form-check-input" id="inp-is-using" disabled>
                    <label class="form-check-label" for="inp-is-using">{% trans 'Using' %}</label>
                </div>
            </div>
        </div>
        <div class="row mb-3">
            <div class="col-12 mb-2">
                <label
                        class="form-label" for="inp-contents"
                >
                    {% trans 'Contents' %}
                </label>
                <button id="idx-btn-print" class="btn btn-sm btn-gradient-primary btn-square ml-1" type="button">{% trans 'Print Preview' %} <i class="ml-1 fa-solid fa-print"></i></button>
            </div>
            <div class="col-12">
                <textarea
                        id="inp-contents"
                        data-css-url-render="{% static 'comment/css/style.css' %}"
                        data-mentions="{% url 'ApplicationPropertyListAPI' %}"
                        name="contents"
                        class="form-control"
                        disabled
                ></textarea>
            </div>
        </div>
    </form>
{% endblock %}

{% block jsFooter %}
    <script src="{% static 'f_extends/print.js' %}"></script>
    <script>
        $(document).ready(function (){
            let frm = $('#frm-detail-print-template');
            if (frm.attr('data-url')){
                $.fn.callAjax2({
                    url: frm.attr('data-url'),
                    method: 'GET'
                }).then(
                    (resp) => {
                        let data = $.fn.switcherResp(resp);
                        if (data && typeof data === 'object' && data.hasOwnProperty('template_detail')){
                            let detail = data.template_detail;
                            // application
                            $('#inp-application').initSelect2({
                                data: [{
                                    ...detail.application,
                                    selected: true,
                                }]
                            })
                            // Title
                            $('#inp-title').val(detail.title || '');
                            // Remarks
                            $('#inp-remarks').val(detail.remarks || '');
                            // Using
                            $('#inp-is-using').prop('checked', detail?.['is_using'] === true);
                            // content
                            let txtArea = $('#inp-contents');
                            PrintTinymceControl.init_tinymce_editable(txtArea, 'b9650500-aba7-44e3-b6e0-2542622702a3', {
                                height: 420,
                                readonly: 1,
                                toolbar: false,
                            }, detail.contents);
                            // Print
                            $('#idx-btn-print').on('click', function (){
                                txtArea.tinymce().execCommand('mcePrint');
                            })
                        }
                    },
                    (errs) => {},
                )
            }
        })
    </script>
{% endblock %}