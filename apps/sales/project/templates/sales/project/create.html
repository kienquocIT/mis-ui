{% extends 'base.html' %}
{% load static i18n %}
{% block title %}
    {% trans 'Project' %} {% trans 'create' %}
{% endblock %}
{% block cssHeader %}
    <link href="{% static 'vendors/daterangepicker/daterangepicker.css' %}" rel="stylesheet" type="text/css"/>
{% endblock %}
{% block pageAction %}
    <button class="btn btn-outline-primary" type="submit" form="project_form">
            <span>
                <span>{% trans 'Save' %}</span>
                <span class="icon">
                    <i class="fa-regular fa-floppy-disk"></i>
                </span>
            </span>
    </button>
{% endblock %}

{% block pageContent %}
    <!-- from create-->
    <form class="container-fluid mt-4" id="project_form" method="post" data-method="post" autocomplete="off"
          data-url-redirect="{% url 'ProjectEdit' 1 %}" data-url="{% url 'ProjectCreateAPI' %}">
        {% csrf_token %}
        <div class="row">
            <div class="col-xs-12 col-md-6 form-group">
                <label for="titleInput" class="form-label required">{% trans 'Title' %}</label>
                <input type="text" name="title" id="titleInput" class="form-control" required>
            </div>
            <div class="clearfix"></div>
            <div class="col-xs-12 col-md-6 form-group">
                <label for="select_project_pm" class="form-label required">{% trans 'Project Owner' %}</label>
                <input type="text" name="employee_inherit" id="employeeInheritInput" class="form-control" readonly
                value="{{ data.employee_info.full_name }}" data-value="{{ data.employee_info.id }}">
            </div>
            <div class="col-xs-12 col-md-6 form-group">
                <label for="selectEmployeeInherit" class="form-label required">{% trans 'Project PM' %}</label>
                <select class="form-select" name="project_pm" id="select_project_pm"
                        data-url="{% url 'EmployeeListAPI' %}"
                        data-keyResp="employee_list" data-keyText="full_name" data-keyId="id"
                        data-params="{'list_from_app':'{{data.list_from_app|escape}}'}"
                >
                </select>
            </div>
            <div class="col-xs-12 col-md-6 form-group">
                <label for="dateStart" class="form-label">{% trans 'Start date' %}</label>
                <div class="input-affix-wrapper">
                    <input type="text" id="dateStart" name="start_date" class="form-control date-picker"
                           autocomplete="off">
                    <span class="input-suffix"><i class="fa-solid fa-calendar-days"></i></span>
                </div>
            </div>
            <div class="col-xs-12 col-md-6 form-group">
                <label for="dateFinish" class="form-label">{% trans 'Finish date' %}</label>
                <div class="input-affix-wrapper">
                    <input type="text" id="dateFinish" name="finish_date" class="form-control date-picker"
                           autocomplete="off">
                    <span class="input-suffix"><i class="fa-solid fa-calendar-days"></i></span>
                </div>
            </div>
            <div class="col-xs-12 col-md-6 form-group">
                {% include 'extends/the-documents/bastion.html' with priority_app='process-inherit' has_opp=False has_process=True is_open=True %}
            </div>
            <input type="hidden" name="system_status" id="SystemStatusInput" class="form-control" value="1">
        </div>
    </form>
{% endblock %}
{% block dataHiddenGroup %}
{% endblock %}
{% block jsFooter %}
    <script src="{% static 'vendors/daterangepicker/daterangepicker.js' %}"></script>
    <script src="{% static 'assets/project/js/project-common.js' %}"></script>
    <script src="{% static 'assets/project/js/create.js' %}"></script>
    <script>
        $(document).ready(function () {
        // run init process
            const {
                opp_id,
                opp_title,
                opp_code,
                process_id,
                process_title,
                process_stage_app_id,
                process_stage_app_title,
                inherit_id,
                inherit_title,
            } = $x.fn.getManyUrlParameters([
                'opp_id', 'opp_title', 'opp_code',
                'process_id', 'process_title',
                'process_stage_app_id', 'process_stage_app_title',
                'inherit_id', 'inherit_title',
            ])

            new $x.cls.bastionField({
                has_opp: false,
                has_inherit: false,
                has_process: true,
                has_prj: false,

                // Thêm dành cho việc load dữ liệu chọn sẵn
                // Dữ liệu có thể lấy từ paramter hoặc doc detail. (Ví dụ là lấy từ paramter)
                data_process: $x.fn.checkUUID4(process_id) ? [
                    {
                        "id": process_id,
                        "title": process_title,
                        "selected": true,
                    }
                ] : [],
                data_process_stage_app: $x.fn.checkUUID4(process_stage_app_id) ? [
                    {
                        "id": process_stage_app_id,
                        "title": process_stage_app_title,
                        "selected": true,
                    }
                ] : [],
            }).init();
        });
    </script>
{% endblock %}
