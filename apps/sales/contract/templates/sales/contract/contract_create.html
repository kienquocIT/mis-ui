{% extends 'base.html' %}
{% load static i18n %}
{% block cssHeader %}
    <link href="{% static 'vendors/select2/dist/css/select2.min.css' %}" rel="stylesheet" type="text/css">
{% endblock %}
{% block pageAction %}
    <button class="btn btn-outline-primary" type="submit" form="frm_contract_create">
        <span>
            <span>{% trans 'Save' %}</span>
            <span class="icon">
                <i class="fa-regular fa-floppy-disk"></i>
            </span>
        </span>
    </button>
{% endblock %}

{% block pageContent %}
    <form
            data-url="{% url 'ContractApprovalListAPI' %}"
            data-url-redirect="{% url 'ContractApprovalList' %}"
            data-method="POST"
            id="frm_contract_create"
            method="post"
    >
        {% csrf_token %}
        <div class="row">
            {% trans 'Select Sale Person' as inherit_title %}
            {% include 'extends/the-documents/bastion.html' with auto_select_current_employee=True priority_app='opp-prj-inherit' opp_title=opp_title has_opp=True has_inherit=True is_open=True inherit_title=inherit_title inherit_required=True %}
            <div class="form-group">
                <label class="form-label required" for="contract-title">{% trans 'Title' %}</label>
                <input
                        type="text" class="form-control"
                        name="title"
                        id="contract-title"
                        required
                >
            </div>
            <label class="form-label required">{% trans 'Document' %}</label>
            <table
                id="datable-contract-document"
                class="table nowrap w-100"
                data-url=""
                data-method="GET"
                data-zone="document_data"
            >
                <thead>
                <tr class="bg-light">
                    <th></th>
                    <th>{% trans 'Document name' %}</th>
                    <th>{% trans 'Action' %}</th>
                </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
            <div class="d-flex justify-content-start mb-3">
                <button type="button" class="btn btn-outline-primary" id="btn-add-doc">
                    <span><span class="icon"><i class="fa-solid fa-plus"></i></span><span>{% trans 'New' %}</span></span>
                </button>
            </div>
        </div>

        <div class="row" id="tabs-area">
            <ul class="nav nav-light nav-tabs">
                <li class="nav-item">
                    <a class="nav-link active" data-bs-toggle="tab" href="#tab_abstract">
                        <span class="nav-icon-wrap mr-1"><i class="fas fa-file-contract"></i></span>
                        <span class="nav-link-text">{% trans 'Abstract' %}</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-bs-toggle="tab" href="#tab_trade">
                        <span class="nav-icon-wrap mr-1"><i class="fas fa-file-invoice-dollar"></i></span>
                        <span class="nav-link-text">{% trans 'Trade review' %}</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-bs-toggle="tab" href="#tab_legal">
                        <span class="nav-icon-wrap mr-1"><i class="fas fa-balance-scale"></i></span>
                        <span class="nav-link-text">{% trans 'Legal review' %}</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-bs-toggle="tab" href="#tab_payment">
                        <span class="nav-icon-wrap mr-1"><i class="fas fa-receipt"></i></span>
                        <span class="nav-link-text">{% trans 'Payment review' %}</span>
                    </a>
                </li>
            </ul>
            <div class="tab-content">
                <div class="tab-pane fade show active" id="tab_abstract">
                    <textarea class="form-control" id="abstract-content"></textarea>
                </div>
                <div class="tab-pane fade" id="tab_trade">
                    <textarea class="form-control" id="trade-content"></textarea>
                </div>
                <div class="tab-pane fade" id="tab_legal">
                    <textarea class="form-control" id="legal-content"></textarea>
                </div>
                <div class="tab-pane fade" id="tab_payment">
                    <textarea class="form-control" id="payment-content"></textarea>
                </div>
            </div>

        </div>


        <button class="btn btn-outline-primary ntt-drawer-toggle-link btn-create-todo"
                id="btn-open-attachment"
                type="button"
                data-drawer-target="#drawer_contract_data"
                data-drawer-active="false"
                data-bs-toggle="tooltip"
                data-bs-placement="top"
                data-bs-original-title="{% trans 'Create' %}"
                hidden
        >
        </button>
        <div
                data-simplebar
                class="ntt-drawer ntt-drawer-right nicescroll-bar"
                data-drawer-width="600"
                data-drawer-push="true"
                id="drawer_contract_data"
        >
            <div class="ntt-drawer-header h-40p">
                <div>
                    <span class="ntt-drawer-header-text">{% trans 'Attachment' %}</span>
                </div>
                <button type="button" class="btn btn-icon btn-rounded btn-flush-light flush-soft-hover btn-lgb ntt-drawer-close" data-bs-dismiss="modal"><span class="icon"><i class="far fa-window-close"></i></span></button>
            </div>
            <div class="ntt-drawer-body">
                <div class="row" id="file-area">
                    <div class="form-group">
                        <label class="form-label" for="contract-doc-remark">{% trans 'Description' %}</label>
                        <textarea class="form-control" rows="3" id="contract-doc-remark" name="remarks" readonly></textarea>
                    </div>
                    <label class="form-label">{% trans 'Attachment' %}</label>
                    <div id="attachment" hidden>
                        {% include 'extends/files/all.html' %}
                    </div>
                    <div id="attachment-tmp" hidden>
                        {% include 'extends/files/all.html' %}
                    </div>
                </div>
            </div>
        </div>

    </form>

    <div class="p-3 mt-5">
        <h6>{% trans 'Comments' %}</h6>
        <button class="btn btn-primary" id="btn-show-comment">{% trans 'Load comments' %}</button>
        <div id="comment-group" style="display:none;">
            {% include 'comment/list.html' %}
        </div>
    </div>
{% endblock %}

{% block dataHiddenGroup %}
    <input
        type="text"
        id="app-trans-factory"
        data-attach-file="{% trans 'Attach file' %}"
        data-view-file="{% trans 'View current file' %}"
        data-delete="{% trans 'Delete' %}"
        data-set-current="{% trans 'Set to current file' %}"
        data-current="{% trans 'Current' %}"
        data-old="{% trans 'Old' %}"
    >
    <input
        type="text"
        id="app-url-factory"
    >
    {{ data.employee_current|json_script:'employee_current' }}
{% endblock %}

{% block jsFooter %}
    <script src="{% static 'vendors/select2/dist/js/select2.full.min.js' %}"></script>
    <script src="{% static 'vendors/daterangepicker/daterangepicker.js' %}"></script>
    <script src="{% static 'assets/js/extends/the-documents/auto-init.js' %}"></script>
    <script src="{% static 'assets/sales/contract/js/contract_common.js' %}"></script>
    <script src="{% static 'assets/sales/contract/js/contract_create.js' %}"></script>
    <script src="{% static 'vendors/tinymce/tinymce.min.js' %}"></script>
    <script src="{% static 'assets/js/extends/the-documents/auto-init.js' %}"></script>
    <script>
        $(document).ready(function (){
            $('#btn-show-comment').on('click', function (){
                $(this).fadeOut({
                    duration: 'fast',
                    always: function (){
                        $(this).remove();
                        let appIdx = "b9650500-aba7-44e3-b6e0-2542622702a3";  // Application: Quotation - Quotation
                        let docIdx = $.fn.getPkDetail();
                        if (docIdx){
                            let modalEle = $('#comment-group');
                            new $x.cls.cmt(modalEle.find('.comment-group'), {'btn_goto_enabled': false}).init(docIdx, appIdx)
                            modalEle.fadeIn('fast');
                        } else {
                            $.fn.notifyB({
                                'description': `{% trans 'Document is not selected.' %}`,
                            }, 'failure');
                        }
                    }
                })
            })
        })
    </script>
{% endblock %}