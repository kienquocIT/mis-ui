{% extends 'base.html' %}
{% load static i18n %}
{% block title %}{% trans 'Purchase Request Create' %}{% endblock %}
{% block cssHeader %}
    <link rel="stylesheet" type="text/css" href="{% static 'vendors/daterangepicker/daterangepicker.css' %}"/>
{% endblock %}
{% block pageAction %}

    <button class="btn btn-outline-primary" type="submit" form="form-create-pr">
        <span>
            <span>{% trans 'Save' %}</span>
            <span class="icon">
                <i class="fa-regular fa-floppy-disk"></i>
            </span>
        </span>
    </button>
{% endblock %}
{% block pageContent %}
    <form id="form-create-pr" data-url="{% url "PurchaseRequestListAPI" %}" data-method="POST"
          data-url-redirect="{% url "PurchaseRequestList" %}">
        <div class="collapse multi-collapse show" id="collapse-area">
            <div class="row">
                <div class="col-12 col-md-6 col-lg-6">
                    <div class="form-group">
                        <label for="title" class="form-label required">{% trans 'Name' %}</label>
                        <input id="title" class="form-control" placeholder="Input Name" name="title" required/>
                    </div>
                </div>
                <div class="col-6 col-md-3 col-lg-3">
                    <div class="form-group">
                        <label for="date-delivery" class="form-label required">{% trans 'Delivered Date' %}</label>
                        <input id="date-delivery" class="form-control" name="delivered_date" required/>
                    </div>
                </div>
                <div class="col-6 col-md-3 col-lg-3">
                    <div class="form-group">
                        <label for="pr-status" class="form-label">{% trans 'Purchase Status' %}</label>
                        <input id="pr-status" class="form-control form-control-line fw-bold" name="purchase_status" value="{% trans 'Wait' %}" data-value="0" readonly required/>
                    </div>
                </div>
                <div class="col-12 col-md-6 col-lg-6">
                    <div class="form-group">
                        <label for="box-select-supplier" class="form-label required">{% trans 'Supplier' %}</label>
                        <span class="input-affix-wrapper">
                            <span class="input-prefix" id="dropdownBeneficiary">
                                <i class="fas fa-info-circle text-primary" aria-expanded="false"
                                   data-bs-toggle="dropdown"></i>
                                <span role="menu" class="dropdown-menu ml-4 pl-3 pr-3 pt-3 pb-3"
                                      style="width: 25rem;">
                                    <div class="row">
                                        <span class="col-7">{% trans "More information" %}</span>
                                        <a class="col-5 text-right" target="_blank"
                                           href="{% url 'AccountDetail' pk=0 %}">
                                            <span class="badge btn-outline-primary">{% trans "More" %}&nbsp;<i
                                                    class="bi bi-arrow-right"></i></span>
                                        </a>
                                    </div>
                                    <div class="dropdown-divider"></div>
                                    <div class="row">
                                        <span class="col-5">{% trans "Supplier Name" %}</span>
                                        <span class="col-7 text-primary span-supplier-name"></span>
                                    </div>
                                    <div class="row">
                                        <span class="col-5">{% trans "Code" %}</span>
                                        <span class="col-7 text-primary span-supplier-code"></span>
                                    </div>
                                </span>
                            </span>
                            <select
                                    class="form-control select2"
                                    id="box-select-supplier"
                                    name="supplier"
                                    data-method="GET"
                                    data-url="{% url "AccountForSaleListAPI" %}"
                                    data-keyResp="account_sale_list"
                                    data-keyText="name"
                                    required
                            >
                            </select>
                        </span>
                    </div>
                </div>
                <div class="col-12 col-md-6 col-lg-6">
                    <div class="form-group">
                        <label for="box-select-contact" class="form-label required">{% trans 'Contact' %}</label>
                        <span class="input-affix-wrapper">
                            <span class="input-prefix" id="dropdownBeneficiary">
                                <i class="fas fa-info-circle text-primary" aria-expanded="false"
                                   data-bs-toggle="dropdown"></i>
                                <span role="menu" class="dropdown-menu ml-4 pl-3 pr-3 pt-3 pb-3"
                                      style="width: 25rem;">
                                    <div class="row">
                                        <span class="col-7">{% trans "More information" %}</span>
                                        <a class="col-5 text-right" target="_blank"
                                           href="{% url 'ContactDetail' pk=0 %}">
                                            <span class="badge btn-outline-primary">{% trans "More" %}&nbsp;<i
                                                    class="bi bi-arrow-right"></i></span>
                                        </a>
                                    </div>
                                    <div class="dropdown-divider"></div>
                                    <div class="row">
                                        <span class="col-5">{% trans "Contact Name" %}</span>
                                        <span class="col-7 text-primary span-contact-name"></span>
                                    </div>
                                    <div class="row">
                                        <span class="col-5">{% trans "Job Title" %}</span>
                                        <span class="col-7 text-primary span-contact-job-title"></span>
                                    </div>
                                    <div class="row">
                                        <span class="col-5">{% trans "Mobile" %}</span>
                                        <span class="col-7 text-primary span-contact-mobile"></span>
                                    </div>
                                    <div class="row">
                                        <span class="col-5">{% trans "Email" %}</span>
                                        <span class="col-7 text-primary span-contact-email"></span>
                                    </div>
                                </span>
                            </span>
                            <select
                                    class="form-select"
                                    id="box-select-contact"
                                    data-method="GET"
                                    name="contact"
                                    data-url="{% url "ContactListAPI" %}"
                                    data-keyResp="contact_list"
                                    data-keyText="fullname"
                                    required
                            >
                            </select>
                        </span>
                    </div>
                </div>
                <div class="col-5 col-md-3 col-lg-3">
                    <div class="form-group">
                        <label for="request-for" class="form-label required">{% trans 'Request For' %}</label>
                        <span class="input-affix-wrapper">
                            <span class="input-prefix" id="dropdownCreator">
                                <a href="#" data-bs-toggle="modal" data-bs-target="#modal-select-request-for">
                                    <i class="fa-solid fa-ellipsis text-primary"></i>
                                </a>
                            </span>
                            <input id="request-for" type="text" class="form-control" name="request_for" readonly>
                        </span>
                    </div>
                </div>
                <div class="col-7 col-md-3 col-lg-3" hidden id="sale-order-code-div">
                    <div class="form-group">
                        <label for="sale-order" class="form-label required">{% trans 'Order Code' %}</label>
                        <input id="sale-order" class="form-control form-control-line text-primary fw-bold" name="sale_order" readonly/>
                    </div>
                </div>
                <div class="col-7 col-md-3 col-lg-3" hidden id="distribution-code-div">
                    <div class="form-group">
                        <label for="stock-plan" class="form-label required">{% trans 'Stock plan code' %}</label>
                        <input id="stock-plan" class="form-control form-control-line text-primary fw-bold" readonly/>
                    </div>
                </div>
                <div class="col-12 col-md-6 col-lg-6">
                    <div class="form-group">
                        <label for="note" class="form-label">{% trans 'Note' %}</label>
                        <textarea id="note" class="form-control" name="note"></textarea>
                    </div>
                </div>
            </div>
        </div>
        <span type="button" data-bs-toggle="collapse" data-bs-target="#collapse-area" aria-expanded="false" aria-controls="collapse-area" class="text-primary btn btn-animated btn-icon btn-xs w-100"><span class="icon" data-bs-toggle="tooltip" data-bs-placement="right" title="{% trans 'Expand / Collapse' %}"><i class="fas fa-angle-double-up text-primary"></i></span></span>

        <div class="row">
            <div class="col-12">
                <ul class="nav nav-light nav-tabs" id="purchase-request-tabs">
                    <li class="nav-item">
                        <a class="nav-link active" data-bs-toggle="tab" href="#tab_line_detail">
                            <span class="nav-link-text">{% trans 'Line Detail' %}</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-bs-toggle="tab" href="#tab_attachment">
                            <span class="nav-link-text">{% trans 'Attachment' %}</span>
                        </a>
                    </li>
                </ul>

                <div class="tab-content" id="tab-content-purchase-request-product">
                    <div class="tab-pane fade show active" id="tab_line_detail">
                        <div class="row">
                            <div class="col-12">
                                <table id="datatable-pr-product-so" class="table nowrap w-100 mb-5 hidden">
                                    <thead>
                                        <tr>
                                        <th class="w-5">#</th>
                                        <th>{% trans "Product" %}</th>
                                        <th>{% trans "Description" %}</th>
                                        <th>{% trans "UoM" %}</th>
                                        <th>{% trans "Quantity" %}</th>
                                        <th>{% trans "Unit Price" %}</th>
                                        <th>{% trans "Tax" %}</th>
                                        <th>{% trans "Subtotal Price" %}</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                                <table data-url-tax="{% url 'TaxListAPI' %}" id="datatable-pr-product-stock-plan" class="table nowrap w-100 mb-5 hidden">
                                    <thead>
                                        <tr>
                                            <th style="min-width: 50px"></th>
                                            <th style="min-width: 200px">{% trans "Product" %}</th>
                                            <th style="min-width: 100px">{% trans "Description" %}</th>
                                            <th style="min-width: 100px">{% trans "UoM" %}</th>
                                            <th style="min-width: 100px">{% trans "Request quantity" %}</th>
                                            <th style="min-width: 200px">{% trans "Unit Price" %}</th>
                                            <th style="min-width: 200px">{% trans "Tax" %}</th>
                                            <th style="min-width: 200px">{% trans "Subtotal Price" %}</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                                <table id="datatable-pr-product-other" class="table nowrap w-100 mb-5 hidden">
                                    <thead>
                                    <tr>
                                    <th class="w-5">#</th>
                                    <th>{% trans "Product" %}</th>
                                    <th>{% trans "Description" %}</th>
                                    <th>{% trans "UoM" %}</th>
                                    <th>{% trans "Quantity" %}</th>
                                    <th>{% trans "Unit Price" %}</th>
                                    <th>{% trans "Tax" %}</th>
                                    <th>{% trans "Subtotal Price" %}</th>
                                    <th class="w-5"></th>
                                    </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                        <div id="distribution-sum-space">
                            <div class="row">
                                <div class="col-12 col-lg-7 mt-3">
                                    <button type="button"
                                                class="btn btn-primary btn-change-pr-product"
                                                data-bs-toggle="modal"
                                                data-bs-target="#modal-select-distribution">{% trans 'Change' %}</button>
                                </div>
                                <div class="col-12 col-lg-5 mt-3 text-right">
                                    <div class="row">
                                        <label for="distribution-sum-pretax" class="col-4 col-form-label text-primary">{% trans 'Pretax Amount' %}</label>
                                        <div class="col-8">
                                            <input id="distribution-sum-pretax" class="form-control form-control-line mask-money text-right text-primary mb-1" value="0" disabled readonly>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <label for="distribution-sum-tax" class="col-4 col-form-label text-primary">{% trans 'Taxes' %}</label>
                                        <div class="col-8">
                                            <input id="distribution-sum-tax" class="form-control form-control-line mask-money text-right text-primary mb-1" value="0" disabled readonly>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <label for="distribution-sum-aftertax" class="col-4 col-form-label text-primary">{% trans 'TOTAL' %}</label>
                                        <div class="col-8">
                                            <input id="distribution-sum-aftertax" class="form-control form-control-line mask-money text-right text-primary mb-1" value="0" disabled readonly>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row" id="sum-space">
                            <div class="col-5">
                                <button type="button"
                                        class="btn btn-primary btn-change-pr-product"
                                        data-bs-toggle="modal"
                                        data-bs-target="#modal-select-sale-order">{% trans 'Change' %}</button>

                                <div class="dropdown">
                                    <button type="button" data-bs-toggle="dropdown" id="btn-add-pr-product"
                                            class="btn btn-primary btn-add-product">{% trans "New Product" %}</button>
                                </div>
                            </div>
                            <div class="col-7 mt-5">
                                <div class="row mb-2">
                                    <div class="col-6"><label for="input-product-pretax-amount">{% trans 'Pretax Amount' %}</label></div>
                                    <div class="col-6">
                                        <input id="input-product-pretax-amount" class="form-control mask-money" readonly>
                                    </div>
                                </div>
                                <div class="row mb-2">
                                    <div class="col-6"><label for="input-product-taxes">{% trans 'Taxes' %}</label></div>
                                    <div class="col-6">
                                        <input id="input-product-taxes" type="text" class="form-control mask-money" data-return-type="number" readonly>
                                    </div>
                                </div>
                                <hr>
                                <div class="row mb-2">
                                    <div class="col-6"><label for="input-product-total">{% trans 'Total' %}</label></div>
                                    <div class="col-6">
                                        <input id="input-product-total" type="text" class="form-control mask-money" data-return-type="number" readonly>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade show active" id="tab_attachment">

                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="modal-select-sale-order" tabindex="-1" role="dialog"
             aria-labelledby="exampleModalLarge01" aria-hidden="true">
            <div class="modal-dialog modal-xl" style="min-width: 80%" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">{% trans 'Select items' %}</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-12 col-md-12 col-lg-5 border rounded">
                                <table id="datatable-sale-order" class="table nowrap w-100 table-hover"
                                       data-url="{% url "SaleOrderPurchasingStaffListAPI" %}"
                                       data-method="GET">
                                    <thead class="bg-primary-light-5">
                                        <tr>
                                            <th style="min-width: 20px"></th>
                                            <th style="min-width: 100px">{% trans "Code" %}</th>
                                            <th style="min-width: 200px">{% trans "Name" %}</th>
                                            <th style="min-width: 50px"></th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                            <div class="col-12 col-md-12 col-lg-7 border rounded">
                                <table id="datatable-product-of-so" class="table nowrap table-hover w-100"
                                       data-method="GET"
                                       data-url="{% url 'ProductListSaleOrderAPI' pk=0 %}"
                                >
                                    <thead class="bg-primary-light-5">
                                        <tr>
                                            <th style="min-width: 20px"></th>
                                            <th style="min-width: 150px">{% trans "Product" %}</th>
                                            <th style="min-width: 50px">{% trans "Quantity" %}</th>
                                            <th style="min-width: 50px">{% trans "Remain" %}</th>
                                            <th style="min-width: 50px"></th>
                                            <th style="min-width: 100px">{% trans "Request" %}</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary"
                                data-bs-dismiss="modal">{% trans "Cancel" %}</button>
                        <button type="button" class="btn btn-primary"
                                id="btn-select-so-product">{% trans 'Next' %}</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="modal-select-distribution" tabindex="-1" role="dialog" aria-labelledby="exampleModalLarge01" aria-hidden="true">
            <div class="modal-dialog modal-xl" role="document" style="min-width: 80%;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">{% trans 'Select items' %}</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-12 col-md-12 col-lg-5 border rounded">
                                <table id="datatable-distribution" class="table nowrap table-hover w-100"
                                       data-url="{% url 'DistributionPlanListAPI' %}"
                                       data-method="GET">
                                    <thead class="bg-primary-light-5">
                                        <tr>
                                            <th style="min-width: 20px"></th>
                                            <th style="min-width: 150px">{% trans "Stock plan" %}</th>
                                            <th style="min-width: 50px"></th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                            <div class="col-12 col-md-12 col-lg-7 border rounded">
                                <table id="datatable-product-of-distribution" class="table nowrap table-hover w-100"
                                       data-method="GET"
                                       data-url="{% url 'DistributionPlanDetailAPI' '0' %}"
                                >
                                    <thead class="bg-primary-light-5">
                                        <tr>
                                            <th style="min-width: 20px"></th>
                                            <th style="min-width: 150px">{% trans "Product" %}</th>
                                            <th style="min-width: 50px">{% trans "Quantity" %}</th>
                                            <th style="min-width: 50px">{% trans "Remain" %}</th>
                                            <th style="min-width: 100px">{% trans "Request" %}</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary"
                                data-bs-dismiss="modal">{% trans "Cancel" %}</button>
                        <button type="button" class="btn btn-primary"
                                id="btn-select-distribution-product">{% trans 'Next' %}</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="modal-select-request-for" tabindex="-1" role="dialog"
             aria-labelledby="exampleModalLabel"
             aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
                <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">{% trans 'Request For' %}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-12 col-md-6 col-lg-3 p-1">
                            <button type="button" class="btn btn-soft-primary w-100" id="btn-select-type-sale-order">{% trans 'For Sale Order' %}</button>
                        </div>
                        <div class="col-12 col-md-6 col-lg-3 p-1">
                            <button class="btn btn-soft-danger w-100" id="btn-select-type-stock-free">{% trans 'For Stock Free' %}</button>
                        </div>
                        <div class="col-12 col-md-6 col-lg-3 p-1">
                            <button class="btn btn-soft-secondary w-100" id="btn-select-type-stock-plan">{% trans 'For Stock Plan' %}</button>
                        </div>
                        <div class="col-12 col-md-6 col-lg-3 p-1">
                            <button class="btn btn-soft-success w-100" id="btn-select-type-other">{% trans 'For Other' %}</button>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{% trans 'Cancel' %}</button>
                </div>
            </div>
            </div>
        </div>

        <div class="hidden">
            <div id="box-select-so-product">
            <span class="input-affix-wrapper">
                <span class="input-prefix" id="dropdownBeneficiary">
                    <i class="fas fa-info-circle text-primary" aria-expanded="false"
                       data-bs-toggle="dropdown"></i>
                    <span role="menu" class="dropdown-menu ml-4 pl-3 pr-3 pt-3 pb-3"
                          style="width: 25rem;">
                        <div class="row">
                            <span class="col-7">{% trans "More information" %}</span>
                            <a class="col-5 text-right"
                               href="{% url 'ProductDetail' pk=0 %}">
                                <span class="badge btn-outline-primary">{% trans "More" %}&nbsp;<i
                                        class="bi bi-arrow-right"></i></span>
                            </a>
                        </div>
                        <div class="dropdown-divider"></div>
                        <div class="row">
                            <span class="col-5">{% trans "Product Name" %}</span>
                            <span class="col-7 text-primary span-product-name"></span>
                        </div>
                        <div class="row">
                            <span class="col-5">{% trans "Code" %}</span>
                            <span class="col-7 text-primary span-product-code"></span>
                        </div>
                        <div class="row">
                            <span class="col-5">{% trans "UoM Group" %}</span>
                            <span class="col-7 text-primary span-product-uom-group"></span>
                        </div>
                        <div class="row">
                            <span class="col-5">{% trans "UoM" %}</span>
                            <span class="col-7 text-primary span-product-uom"></span>
                        </div>
                    </span>
                </span>
                <select
                        class="form-control box-select-product"
                        data-method="GET"
                        data-url="{% url "ProductForSaleListAPI" %}"
                        data-keyResp="product_sale_list"
                >
                </select>
            </span>
            </div>
            <div id="box-select-so-product-uom">
                <select class="form-select box-select-uom"
                        data-method="GET"
                        data-url="{% url "UnitOfMeasureListAPI" %}"
                        data-keyResp="unit_of_measure"
                ></select>
            </div>
            <div id="box-select-so-product-tax">
                <select class="form-select box-select-tax"
                        data-method="GET"
                        data-url="{% url "TaxListAPI" %}"
                        data-keyResp="tax_list"
                ></select>
            </div>
        </div>
    </form>

    <script type="application/json" id="data-sale-order">{}</script>
    <script type="application/json" id="data-sale-order-product">{}</script>
    <script type="application/json" id="data-self-product">{}</script>

{% endblock %}
{% block dataHiddenGroup %}
    <input id="employee_current_id" value="{{ request.user.employee_current_data.id }}"/>
    <input id="trans-factory"
           data-trans-more-info="{% trans 'More Information' %}"
           data-trans-more="{% trans 'More' %}"
           data-trans-product-name="{% trans 'Product Name' %}"
           data-trans-code="{% trans 'Code' %}"
           data-trans-view-detail="{% trans 'View Detail' %}"
           data-trans-request-greater-remain="{% trans "Num of product request can not greater than num of product remain" %}"
           data-trans-enter-request="{% trans 'Request number can not blank' %}"
    />

    <input type="text" id="url-factory"
           data-url-config="{% url 'PurchaseRequestConfigAPI' %}"
           data-url-product-detail="{% url 'ProductDetail' pk=0 %}"
           data-url-account-detail="{% url 'AccountDetail' pk=0 %}"
           data-url-contact-detail="{% url 'ContactDetail' pk=0 %}"
           data-url-so-product="{% url 'ProductListSaleOrderAPI' pk=0 %}"
           data-url-uom-group="{% url 'UnitOfMeasureGroupListAPI' %}"
           data-url-this-page="{% url 'PurchaseRequestCreate' %}"
           data-url-uom="{% url 'UnitOfMeasureListAPI' %}"
    />
{% endblock %}
{% block jsFooter %}

    <script src="{% static 'vendors/daterangepicker/daterangepicker.js' %}"></script>
    <script src="{% static 'assets/sales/purchasing/js/purchase_request/purchase_request_common.js' %}"></script>
    <script src="{% static 'assets/sales/purchasing/js/purchase_request/purchase_request_create.js' %}"></script>
{% endblock %}
