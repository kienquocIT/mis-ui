{% load static i18n compress %}
<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Meta Tags -->
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {% if base.tenant_current_data %}
        <title>{{ base.tenant_current_data.code|upper }} - {{ base.tenant_current_data.title }}</title>
    {% else %}
        <title>MIS - {% block title %}Management Information System{% endblock %}</title>
    {% endif %}
    <meta name="description" content="MIS - Management Information System - quantrimis.com.vn"/>

    <!-- Favicon -->
    <link rel="shortcut icon" href="{% static 'assets/images/logo/logo-28x16.png' %}">
    <link rel="icon" href="{% static 'assets/images/logo/logo-28x16.png' %}" type="image/x-icon">

    {% compress css %}
        <!-- Data Table CSS -->
        <link
                href="{% static 'vendors/datatables.net-bs5/css/dataTables.bootstrap5.min.css' %}" rel="stylesheet"
                type="text/css"
        />
        <link
                href="{% static 'vendors/datatables.net-responsive-bs5/css/responsive.bootstrap5.min.css' %}"
                rel="stylesheet" type="text/css"
        />
        <link
                href="{% static 'vendors/bootstrap@4.0.0/dist/css/bootstrap.min.css' %}"
                rel="stylesheet" type="text/css"
        />

        <!-- CSS -->
        <link href="{% static 'assets/css/style.css' %}" rel="stylesheet" type="text/css">
        <link href="{% static 'assets/css/loading-spinner.css' %}" rel="stylesheet" type="text/css">
        <link href="{% static 'assets/css/my-style.css' %}" rel="stylesheet" type="text/css">
        <link href="{% static 'assets/css/notify.css' %}" rel="stylesheet" type="text/css">
        <style>
            @font-face {
                font-family: "Roboto";
                src: url({% static 'assets/fonts/roboto/Roboto-Regular.ttf' %});
            }
        </style>
        <link href="{% static 'vendors/select2/dist/css/select2.min.css' %}" rel="stylesheet" type="text/css">
        <link href="{% static 'assets/css/plugins/drawer.css' %}" rel="stylesheet" type="text/css">
        {% block cssHeader %}
        {% endblock %}
        <style>
            {#  Override css of select2 for select2 working in Bootstrap Modal  #}
            .select2-close-mask {
                z-index: 2099;
            }

            .select2-dropdown {
                z-index: 3051;
            }

            {# bell ringing #}
            @keyframes bell-shake {
                0% {
                    transform: rotate(0deg);
                }
                20% {
                    transform: rotate(0deg);
                }
                40% {
                    transform: rotate(15deg);
                }
                50% {
                    transform: rotate(-15deg);
                }
                60% {
                    transform: rotate(15deg);
                }
                80% {
                    transform: rotate(0deg);
                }
                100% {
                    transform: rotate(0deg);
                }
            }

            .my-bell-ring {
                animation: bell-shake 1s infinite;
            }
            {#  -- bell ringing #}
        </style>
        <link href="{% static 'vendors/sweetalert2/dist/sweetalert2.min.css' %}" rel="stylesheet" type="text/css">
    {% endcompress %}
    {% compress js %}
        {% block jsHeader %}{% endblock %}
    {% endcompress %}
</head>
<body>
<!-- Wrapper -->
<div
        class="hk-wrapper" data-layout="vertical" data-layout-style="collapsed" data-menu="light" data-footer="simple"
        data-hover="active"
>
    <p
            style="display: none" id="get-menu-active" data-nav-menu="{{ nav.menu_id_current }}"
            data-nav-tenant="{{ nav.space_code_current }}"
    ></p>
    {% include 'extends/top_nav.html' %}

    <!-- Vertical Nav -->
    <div class="hk-menu">
        {% include 'extends/vertical_nav_brand.html' %}

        {% include 'extends/vertical_nav_main_menu.html' %}
    </div>
    <div id="hk_menu_backdrop" class="hk-menu-backdrop"></div>
    <!-- /Vertical Nav -->

    <!-- Main Content -->
    <div class="hk-pg-wrapper pb-0">
        <div class="hk-pg-body py-0">
            <div class="blogapp-wrap blogapp-sidebar-toggle">
                <nav class="blogapp-sidebar">
                    {% include 'extends/app_sidebar.html' %}
                </nav>
                <div class="blogapp-content">
                    <div class="blogapp-detail-wrap">
                        <header class="blog-header">
                            <div class="d-flex align-items-center">
                                {% include 'extends/breadcrumb.html' %}
                            </div>
                            <div class="blog-options-wrap" id="idxPageAction">
                                <div class="{% if pk %}hidden{% endif %}" id="idxRealAction">
                                    {% block pageAction %}{% endblock %}
                                </div>
                                <button
                                        type="submit"
                                        class="hidden btn-save-at-zone-wf btn btn-icon btn-flush-dark btn-rounded flush-soft-hover"
                                        form=""
                                        data-value=""
                                        id="idxSaveInZoneWF"
                                >
                                    <span
                                            class="icon"
                                            data-bs-toggle="tooltip"
                                            data-bs-placement="bottom"
                                            data-bs-original-title="{% trans 'Save in Zone' %}"
                                    ><i class="fa-solid fa-floppy-disk"></i></span>
                                </button>
                                <button
                                        type="button"
                                        class="hidden btn btn-icon btn-flush-dark btn-rounded flush-soft-hover"
                                        id="btn-active-edit-zone-wf"
                                >
                                    <span
                                            class="icon"
                                            data-bs-toggle="tooltip"
                                            data-bs-placement="bottom"
                                            data-bs-original-title="{% trans 'Open edit in Zones' %}"
                                    ><i class="fa-solid fa-unlock"></i></span>
                                </button>
                                <button
                                        type="button"
                                        class="hidden btn-action-wf btn btn-icon btn-flush-dark btn-rounded flush-soft-hover"
                                        data-value=""
                                        id="btnMainAction"
                                >
                                    <span
                                            class="icon"
                                            data-bs-toggle="tooltip"
                                            data-bs-placement="bottom"
                                            data-bs-original-title="{% trans 'Approval' %}"
                                    ></span>
                                </button>

                                <div class="dropdown hidden">
                                    <button
                                            aria-expanded="false" data-bs-toggle="dropdown"
                                            class="btn btn-default btn-icon btn-flush-dark btn-rounded flush-soft-hover"
                                            type="button"
                                    >
                                        <span
                                                class="icon"
                                                data-bs-toggle="tooltip"
                                                data-bs-placement="bottom"
                                                data-bs-original-title="{% trans 'More actions' %}"
                                        >
                                            ...
                                        </span>
                                    </button>
                                    <div role="menu" class="dropdown-menu" id="idxGroupAction">
                                        {% for key, value in base_workflow.items %}
                                            <li class="hidden btn-action-wf" data-value="{{ key }}">
                                                <div class="dropdown-item"><i
                                                        class="icon-action-wf mr-1 {{ value.1 }}"
                                                ></i> {{ value.0 }}</div>
                                            </li>
                                        {% endfor %}
                                    </div>
                                    {% if base_workflow.length > 0 %}
                                        {% csrf_token %}
                                    {% endif %}
                                </div>

                                <div class="v-separator  d-lg-inline-block d-none"></div>

                                <button
                                        id="btnLogShow"
                                        class="hidden btn btn-icon btn-rounded bg-dark-hover mr-1 ntt-drawer-toggle-link"
                                        data-drawer-target="#drawer_log_data"
                                        data-drawer-active="false"
                                        href="#"
                                        data-bs-toggle="tooltip"
                                        data-bs-placement="bottom"
                                        data-bs-original-title="{% trans 'Log' %}"
                                        data-url-runtime-detail="{% url 'FlowRuntimeDetailAPI' pk=1 %}"
                                >
                                    <span class="icon icon-xs">
                                        <i class="fas fa-history fa-sm"></i>
                                    </span>
                                </button>
                                <button
                                        class="btn btn-icon btn-rounded bg-dark-hover mr-1 hk-navbar-togglable"
                                        data-bs-toggle="tooltip"
                                        data-bs-placement="bottom"
                                        data-bs-original-title="{% trans 'Collapse' %}"
                                >
                                    <span class="icon">
                                        <i class="fa-solid fa-chevron-up fa-sm"></i>
                                        <i class="fa-solid fa-chevron-down fa-sm d-none"></i>
                                        <!-- <span class="feather-icon"><i data-feather="chevron-up"></i></span> -->
                                        <!-- <span class="feather-icon d-none"><i data-feather="chevron-down"></i></span> -->
                                    </span>
                                </button>
                            </div>
                            <div class="hk-sidebar-togglable active"></div>
                        </header>
                        <div class="blog-body">
                            <div data-simplebar class="nicescroll-bar" id="idxPageContent">
                                {% block pageContent %}
                                {% endblock %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- /Page Body -->
    </div>
    <!-- /Main Content -->

    <!-- spinner loading -->
    <div id="loadingContainer" class="loading-container hidden">
        <div class="my-spinner">
            <div class="my-circle my-circle-1"></div>
            <div class="my-circle my-circle-2"></div>
            <div class="my-circle my-circle-3"></div>
            <div class="my-circle my-circle-4"></div>
            <div class="my-circle my-circle-5"></div>
        </div>
    </div>
    <!-- /spinner loading -->
    <!-- Message translate usually -->
    <div class="hidden">
        <span id="msg-user-language">{{ base.language }}</span>
        <span id="msg-datatable-language-config">
            {% if base.language == 'vi' %}
                {% static 'assets/js/cdn-clone/datatable/i18n/vi.json' %}
            {% elif base.language == 'en' %}
                {% static 'assets/js/cdn-clone/datatable/i18n/en.json' %}
            {% else %}
                <!-- Proud of Vietnamese products -->
                {% static 'assets/js/cdn-clone/datatable/i18n/vi.json' %}
            {% endif %}
        </span>
        <span id="urlCompanyConfig" data-url="{% url 'CompanyConfigDetailAPI' %}"></span>
        <span id="urlCompanyConfigData"></span>

        <span id="urlCompanyConfig1" data-url="{% url 'CompanyConfigDetailAPI' %}"></span>
        <span id="urlCompanyConfigData1"></span>

        <span id="msgReloadPageIn">{% trans 'Auto reload has been applied after the timeout!' %}</span>
        <span id="msgLabelReloadPageIn">{% trans 'Change Space to ' %}</span>
        <span id="msgFieldRequired">{% trans 'This field is required' %}</span>
        <span id="msgSuccess">{% trans 'Successfully' %}</span>
        <span id="flagIsDebug" data-is-debug={{ is_debug }}></span>
        <span id="flagNotifyKey" data-value={{ is_notify_key }}></span>
        <span id="idWFRuntime" data-runtime-id=""></span>
        <span id="idUrlTaskDetail" data-url="{% url 'FlowRuntimeTaskDetailAPI' pk=1 %}"></span>
        <span id="idPKDetail" data-pk="{{ pk }}"></span>

        {% if data.input_mapping_properties %}
            {{ data.input_mapping_properties|json_script:"input_mapping_properties" }}
        {% endif %}
        {% if data.form_id %}
            <span id="idFormID" data-form-id="{{ data.form_id }}"></span>
        {% endif %}
        <span id="idBtnIDLastSubmit" data-id></span>
    </div>
    <!-- /Message translate usually -->
    <!-- /Message translate base -->
    <input
            type="hidden" id="base-trans-factory" data-view-detail="{% trans 'View detail' %}"
            data-more-info="{% trans 'More Information' %}"
            data-draft="{% trans 'Draft' %}"
            data-created="{% trans 'Created' %}"
            data-added="{% trans 'Added' %}"
            data-finish="{% trans 'Finish' %}"
            data-cancel="{% trans 'Cancel' %}"
            data-confirm="{% trans 'Confirm' %}"
            data-loading="{% trans 'Loading' %}"
            data-success="{% trans 'Successfully' %}"
            data-are-you-sure="{% trans 'Are you sure about this change?' %}"
            data-no-data="{% trans 'No data available' %}"
    >
    <!-- /Message translate base -->

    <!-- Render Company Config -->
    {{ config|json_script:"idConfigValue" }}
    <!-- // Render Company Config -->

    <div class="hidden">
        {% block dataHiddenGroup %}{% endblock %}
    </div>

    <!-- Drawer Log and Activity -->
    <div
            data-simplebar
            class="ntt-drawer ntt-drawer-right nicescroll-bar"
            data-drawer-width="500"
            data-drawer-push="true"
            id="drawer_log_data"
            data-url="{% url 'FlowRuntimeDiagramDetailAPI' pk=1 %}"
    >
        <div class="ntt-drawer-header">
            <div><span class="ntt-drawer-header-text"></span></div>
            <button class="btn btn-icon btn-xs btn-rounded bg-dark-hover ntt-drawer-close">
                <span class="icon">
                    <span aria-hidden="true"><i class="fas fa-times"></i></span>
                </span>
            </button>
        </div>
        <div class="ntt-drawer-body">
            <div class="ntt-drawer-content-wrap">
                <ul class="nav nav-light nav-tabs">
                    <li class="nav-item">
                        <a class="nav-link active" data-bs-toggle="tab" href="#tab_block_diagram">
                            <span class="nav-link-text">{% trans 'Diagram' %}</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-bs-toggle="tab" href="#tab_block_activities">
                            <span class="nav-link-text">{% trans 'Activities' %}</span>
                        </a>
                    </li>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane fade show active" id="tab_block_diagram">
                        <div class="spinner-grow" id="idxDataRuntimeLoading" role="status">
                            <span class="sr-only">{% trans 'Loading' %}...</span>
                        </div>
                        <div class="hidden" id="idxDataRuntimeNotFound">
                            <b>
                                {% trans "The document approved because the feature config don't apply workflow" %}
                            </b>
                        </div>
                        <div id="idxDataRuntime" class="hidden" style="width: calc(100% - 3px)">

                        </div>
                    </div>
                    <div
                            class="tab-pane fade" id="tab_block_activities"
                            data-url="{% url 'ActivityLogListAPI' %}?doc_id={{ pk }}"
                    >
                        <span id="elementTypingText"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- // Drawer Log and Activity -->

    <!-- Raise a ticket -->
    <div
            class="modal fade" id="modalRaiseTicket" tabindex="-1" role="dialog" aria-labelledby="modalRaiseTicket"
            aria-hidden="true"
    >
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <form
                        id="frm-send-a-ticket" data-url="{% url 'TicketErrorCreateAPI' %}" data-method="POST"
                        enctype="multipart/form-data"
                >
                    {% csrf_token %}
                    <div class="modal-header">
                        <h5 class="modal-title">{% trans 'Raise a ticket' %}</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <!-- hidden input -->
                        <div class="form-group hidden">
                            <label for="ticket-email-auto" class="form-label">{% trans 'Email' %}</label>
                            <input class="form-control" type="text" id="ticket-email-auto" name="email"/>
                        </div>
                        <div class="form-group hidden">
                            <label
                                    for="ticket-location-raise-auto" class="form-label"
                            >{% trans 'Location raise' %}</label>
                            <input
                                    class="form-control" type="text" id="ticket-location-raise-auto"
                                    name="location_raise"
                            />
                        </div>
                        <!-- hidden input -->
                        <div class="form-group">
                            <label for="ticket-email" class="form-label">{% trans 'Email' %}</label>
                            <input class="form-control" type="text" id="ticket-email" name="email_input"/>
                        </div>
                        <div class="form-group">
                            <label for="ticket-location-raise" class="form-label">{% trans 'Location raise' %}</label>
                            <input
                                    class="form-control" type="text" id="ticket-location-raise"
                                    name="location_raise_input"
                            />
                        </div>
                        <div class="form-group">
                            <label for="ticket-title" class="form-label required">{% trans 'Title' %}</label>
                            <input type="text" class="form-control" id="ticket-title" name="title"/>
                        </div>
                        <div class="form-group">
                            <label for="ticket-hash-tag" class="form-label required">{% trans 'Hash Tag' %}</label>
                            <select
                                    name="hash_tags" id="ticket-hash-tag" class="form-control" multiple="multiple"
                            >
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                            </select>
                            <small class="text-muted">{% trans 'Allow input new tag' %}</small>
                        </div>
                        <div class="form-group">
                            <label for="ticket-remarks" class="form-label required">{% trans 'Descriptions' %}</label>
                            <textarea class="form-control" id="ticket-remarks" name="remarks"></textarea>
                        </div>
                        <div class="form-group">
                            <div id="ticket-attachment-preview">
                            </div>
                            <label
                                    for="ticket-attachments" class="form-label"
                            >{% trans 'Attachments' %}</label>
                            <input
                                    type="file" class="form-control" id="ticket-attachments" name="attachments" multiple
                                    accept="image/jpeg, image/png, image/gif"
                            />
                            <small class="text-muted">{% trans 'Accept type' %}: *.jpeg, *.png, *.gif</small>
                        </div>
                        <div class="form-group hidden">
                            <label for="staticTicketResp" class="form-label">{% trans 'Code Ticket' %}</label>
                            <input
                                    type="text" readonly class="form-control-plaintext text-danger"
                                    id="staticTicketResp"
                            >
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button
                                type="button" class="btn btn-secondary" data-bs-dismiss="modal"
                        >{% trans 'Close' %}</button>
                        <button type="submit" class="btn btn-primary">{% trans 'Send a ticket' %}</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- // Raise a ticket -->
</div>
<!-- /Wrapper -->

{% compress js %}
    <!-- jQuery -->
    <script src="{% static 'vendors/jquery/dist/jquery.min.js' %}"></script>
    <script src="{% static 'vendors/jquery-validate/jquery.validate.min.js' %}"></script>

    <!-- Bootstrap Core JS -->
    <script src="{% static 'vendors/bootstrap/dist/js/bootstrap.bundle.min.js' %}"></script>

    <!-- FeatherIcons JS -->
    <script src="{% static 'assets/js/feather.min.js' %}"></script>

    <!-- Fancy Dropdown JS -->
    <script src="{% static 'assets/js/dropdown-bootstrap-extended.js' %}"></script>

    <!-- Simplebar JS -->
    <script src="{% static 'vendors/simplebar/dist/simplebar.min.js' %}"></script>

    <!-- Data Table JS -->
    <script src="{% static 'vendors/datatables.net/js/jquery.dataTables.min.js' %}"></script>
    <script src="{% static 'vendors/datatables.net-bs5/js/dataTables.bootstrap5.min.js' %}"></script>
    <script src="{% static 'vendors/datatables.net-select/js/dataTables.select.min.js' %}"></script>

    <!-- Select2 JS -->
    <script src="{% static 'vendors/select2/dist/js/select2.full.min.js' %}"></script>

    <!-- Init JS -->
    <script src="{% static 'assets/js/notify.js' %}"></script>
    <script src="{% static 'assets/js/bootstrap-notify.min.js' %}"></script>
    <script src="{% static 'assets/js/init.js' %}"></script>
    <script src="{% static 'assets/js/chips-init.js' %}"></script>
    <script src="{% static 'assets/js/init-loader.js' %}"></script>
    <script src="{% static 'vendors/datatables.net/js/jquery.dataTables.min.js' %}"></script>
    <script src="{% static 'assets/js/plugins/drawer.js' %}"></script>
    <script src="{% static 'vendors/sweetalert2/dist/sweetalert2.min.js' %}"></script>

    <!-- Typing text JS -->
    <script src="{% static 'assets/js/plugins/typed.umd.js' %}"></script>
    <script>
        new Typed('#elementTypingText', {
            strings: [
                `Page is developing...`,
            ],
            typeSpeed: 50,
        });
    </script>
    <!-- // Typing text JS -->

    <script>
        function change_space() {
            function executeTimeOutChangeSpace(urlData, methodData, spaceCode, spaceName, urlRedirectData) {
                let baseMsg = $('#base-trans-factory');
                Swal.fire({
                    title: $('#msgLabelReloadPageIn').text() + `"${spaceName}"`,
                    html: $('#msgReloadPageIn').text() + '<br>',
                    timer: 2000,
                    timerProgressBar: true,
                    showCancelButton: true,
                    cancelButtonText: baseMsg.attr('data-cancel'),
                    showConfirmButton: true,  // Hiển thị nút Confirm
                    confirmButtonText: baseMsg.attr('data-confirm'),
                }).then((result) => {
                    if (result.value) {
                        {#console.log('Người dùng đã xác nhận');#}
                        callChangeSpaceAndReload(urlData, methodData, spaceCode, urlRedirectData);
                    } else if (result.dismiss === Swal.DismissReason.cancel) {
                        {#console.log('Người dùng đã hủy bỏ');#}
                    } else if (result.dismiss === Swal.DismissReason.timer || result.isConfirmed) {
                        {#console.log('Timeout or confirmed!')#}
                        callChangeSpaceAndReload(urlData, methodData, spaceCode, urlRedirectData);
                    }
                });
            }

            $('#btnTestAlert').click(function () {
                executeTimeOutChangeSpace();
            })

            function callChangeSpaceAndReload(urlData, methodData, spaceCode, urlRedirectData) {
                $.fn.showLoading();
                $.fn.callAjax(
                    urlData,
                    methodData,
                    {'space_code': spaceCode},
                    true,
                ).then(
                    (resp) => {
                        let data = $.fn.switcherResp(resp);
                        if (data && data['status'] === 200) {
                            $.fn.notifyB({
                                'description': $('#base-trans-factory').attr('data-success')
                            }, 'success');
                            setTimeout(
                                () => {
                                    window.location.href = urlRedirectData;
                                }, 1000,
                            );
                        }
                        setTimeout(
                            () => {
                                $.fn.hideLoading();
                            },
                            1000
                        );
                    },
                    (errs) => {
                        $.fn.hideLoading();
                    }
                )
            }

            $('.space-item').click(function (event) {
                event.preventDefault();
                let space_selected = $('#menu-tenant').attr('data-space-selected');
                let urlData = $(this).closest('.dropdown-menu').attr('data-url');
                let urlRedirectData = $(this).closest('.dropdown-menu').attr('data-url-redirect');
                let methodData = $(this).closest('.dropdown-menu').attr('data-method');
                let spaceCode = $(this).attr('data-space-code');
                if (spaceCode !== space_selected) {
                    executeTimeOutChangeSpace(urlData, methodData, spaceCode, $(this).attr('data-space-name'), urlRedirectData);
                }
            })
        }

        function active_menu(item) {
            if (item.length > 0) {
                item.first().addClass('active')
                let parent = item.first().parents('.nav-item');
                if (parent.length > 0) {
                    parent.first().addClass('active');
                    active_menu(parent.first());
                }
            }
            return null;
        }

        function menu_handler() {
            let nav_data = $('#get-menu-active');
            let menu_id_active = nav_data.attr('data-nav-menu');
            if (menu_id_active) {
                let ele_menu = $('#' + menu_id_active);
                if (ele_menu) {
                    active_menu(ele_menu);
                }
            }
            let tenant_code_active = nav_data.attr('data-nav-tenant');
            if (tenant_code_active) $('#menu-tenant').children('option[value=' + tenant_code_active + ']').attr('selected', 'selected');
        }

        <!-- ## function utils -->

        $(document).on('focus', 'input.mask-money', function () {
            return MaskMoney2.focusInputMoney($(this));
        });
        $(document).on('blur', 'input.mask-money', function () {
            return MaskMoney2.blurInputMoney($(this));
        });
        $(document).on('input', 'input.mask-money', function () {
            return MaskMoney2.realtimeInputMoney($(this));
        });

        $(document).ready(function () {
            <!-- Toggle Collapse -->
            $('.hk-navbar-togglable').click(function (event) {
                $(this).find('.icon').children().toggleClass('d-none');
            });
            <!-- ## Toggle Collapse -->

            <!-- Space current -->
            change_space();
            <!-- ## Space current -->

            <!-- Loading table ajax -->
            $(document).find('table').each((idx, tbl) => {
                if (!$(tbl).attr('load-data-hide-spinner')) {
                    $(tbl).on('preXhr.dt', (e, settings, data) => $.fn.showLoading());
                    $(tbl).on('draw.dt', () => $.fn.hideLoading());
                }
            });
            <!-- ## Loading table ajax -->

            <!-- Active menu -->
            menu_handler();
            <!-- ## Active menu -->

            <!-- Init Mask Money -->
            $.fn.initMaskMoney2();
            <!-- ## Init Mask Money -->

            <!-- Init select2 -->
            $(".select2").select2();
            <!-- ## Init select2 -->

            <!-- Raise a ticket -->
            $('#ticket-hash-tag').select2({
                tags: true,
                tokenSeparators: [',', ' ']
            });
            $('#modalRaiseTicket').on('shown.bs.modal', function () {
                $('#ticket-email').val($('#email-request-owner').text());
                $('#ticket-email-auto').val($('#email-request-owner').text());
                $('#ticket-location-raise').val(window.location);
                $('#ticket-location-raise-auto').val(window.location);
            });

            $("#ticket-attachments").change(function () {
                let previewContainer = $("#ticket-attachment-preview");
                previewContainer.empty();

                if (this.files) {
                    let filesAmount = this.files.length;
                    for (let i = 0; i < filesAmount; i++) {
                        let reader = new FileReader();
                        reader.onload = function (event) {
                            let imgElement = $("<img>");
                            imgElement.attr("src", event.target.result);
                            imgElement.css({
                                "max-width": "100px",
                                "max-height": "100px"
                            });
                            previewContainer.append(imgElement);
                        };
                        reader.readAsDataURL(this.files[i]);
                    }
                }
            });

            let ticketFrm = $('#frm-send-a-ticket');
            ticketFrm.submit(function (event) {
                event.preventDefault();

                let urlData = $(this).attr('data-url');
                let methodData = $(this).attr('data-method');

                let formData = new FormData(this);
                formData.append("attachments", document.getElementById('ticket-attachments').files);

                $.fn.showLoading();
                $.ajax({
                    url: urlData, // point to server-side URL
                    dataType: 'json', // what to expect back from server
                    cache: false,
                    contentType: false,
                    processData: false,
                    //data: {'data': form_data, 'csrfmiddlewaretoken': csrf_token},
                    data: formData,
                    type: methodData,
                    success: function (resp) { // display success response
                        let data = $.fn.switcherResp(resp)
                        ticketFrm.find('input').attr('readonly', 'readonly');
                        ticketFrm.find('textarea').attr('readonly', 'readonly');
                        $('#staticTicketResp').val(data?.ticket?.code).closest('.form-group').removeClass('hidden');
                        $.fn.notifyB({
                            'description': $('#base-trans-factory').attr('data-success')
                        }, 'success')
                        $.fn.hideLoading();
                    },
                    error: function (response) {
                        $.fn.notifyB({
                            'description': 'Try again!'
                        }, 'failure');
                        $.fn.hideLoading();
                    }
                });
            });
            <!-- ## Raise a ticket -->

        });
    </script>
    {% block jsFooter %}
    {% endblock %}
{% endcompress %}
</body>
</html>