{% extends 'base.html' %}
{% load i18n %}
{% load static %}
{% block title %}{% trans 'Delivery Edit' %}{% endblock %}
{% block cssHeader %}
    <link href="{% static 'sales/delivery/delivery/css/delivery.css' %}" rel="stylesheet" type="text/css"/>
    <link href="{% static 'vendors/daterangepicker/daterangepicker.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'vendors/select2/dist/css/select2.min.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'vendors/flatpickr/themes/airbnb.css' %}" rel="stylesheet" type="text/css"/>
    <link href="{% static 'vendors/flatpickr/flatpickr.min.css' %}" rel="stylesheet" type="text/css"/>
    <style>
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none !important;
            margin: 0 !important;
        }

        #upload-area {
            height: 150px;
            line-height: 150px;
            background-size: auto 100%;
            background-repeat: no-repeat;
            background-position: center top;
            text-align: center;
            cursor: pointer;
        }

        .pointer {
            cursor: pointer;
        }
        .text-gift{
            color:#e95144;
        }
        .txt-cl-black{
            color: #0c0c0c!important;
        }
        #modal_choise_logistics .modal-body{
            min-height: 280px;
        }
        .left-0{
            left:0;
        }
    </style>
{% endblock %}
{% block jsHeader %}
{% endblock %}

{% block pageAction %}
    {% include 'extends/systems/page_actions.html' with is_save=True save_frm='delivery_form' %}
{% endblock %}

{% block pageContent %}
    <form id="delivery_form" data-url="{% url 'OrderDeliveryDetailAPI' data.pk %}" data-method="PUT" method="post"
          novalidate data-url-redirect="{% url 'OrderDeliveryList' %}">
        <div class="row mb-3">
            {% csrf_token %}
            <div class="col-12 col-md-6 col-lg-6">
                <div class="row">
                    <div class="col-12 col-md-6 col-lg-6">
                        <div class="form-group">
                            <label for="inputSaleOrder" class="form-label deli-for sale-order">{% trans 'Sale Order' %}</label>
                            <label for="inputSaleOrder" class="form-label deli-for lease-order" hidden>{% trans 'Lease order' %}</label>
                            <label for="inputSaleOrder" class="form-label deli-for service-order" hidden>{% trans 'Service order' %}</label>
                            <input type="text" class="form-control form-control-line mt-1" id="inputSaleOrder" value="{% trans 'None' %}" readonly>
                        </div>
                    </div>
                    <div class="col-12 col-md-6 col-lg-6">
                        <div class="form-group">
                            <label class="form-label">{% trans 'Delivery status' %}</label>
                            <p id="state"></p>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="customer_id" class="form-label">{% trans 'to Customer' %}</label>
                    <div class="input-group">
                        <div class="dropdown input-group-text pointer">
                            <i class="fas fa-info-circle text-blue"
                               data-bs-toggle="dropdown"
                               data-dropdown-animation
                               aria-haspopup="true"
                               aria-expanded="false"></i>
                            <div class="dropdown-menu w-210p mt-2"></div>
                        </div>
                        <input type="text" name="customer_id" id="customer_id" class="form-control" readonly/>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 col-md-6 col-lg-6">
                        <div class="form-group">
                            <label for="contact_id" class="form-label">{% trans 'Contact name' %}</label>
                            <div class="input-group">
                                <div class="dropdown input-group-text pointer">
                                    <i class="fas fa-info-circle text-blue"
                                       data-bs-toggle="dropdown"
                                       data-dropdown-animation
                                       aria-haspopup="true"
                                       aria-expanded="false"></i>
                                    <div class="dropdown-menu w-210p mt-2"></div>
                                </div>
                                <input type="text" name="contact_id" id="contact_id" class="form-control" readonly/>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-md-6 col-lg-6">
                        <div class="form-group" id="wrap-employee_inherit" data-is_lead="{{ data.is_lead }}">
                            <label for="selectEmployeeInherit" class="form-label">{% trans 'Employee inherit' %}</label>
{#                            <select class="form-select" name="employee_inherit" id="selectEmployeeInherit"#}
{#                                    {% if not data.is_lead %}disabled{% endif %}>#}
{#                                <option value=""></option>#}
{#                                {% if data.lead %}#}
{#                                    <option value="{{ data.lead.id }}">{{ data.lead.full_name }}</option>#}
{#                                {% endif %}#}
{#                                {% for item in data.person_list %}#}
{#                                    <option value="{{ item.id }}">{{ item.full_name }}</option>#}
{#                                {% endfor %}#}
{#                            </select>#}
                            <select
                                    class="form-select"
                                    id="selectEmployeeInherit"
                                    data-url="{% url "EmployeeListAllAPI" %}"
                                    data-method="GET"
                                    name="employee_inherit"
                                    data-keyResp="employee_list"
                                    data-keyText="full_name"
                                    disabled
                            ></select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-12 col-md-6 col-lg-6">
                <div class="row">
                    <div class="col-12 col-md-6 col-lg-6">
                        <div class="form-group">
                            <label for="inputDeliveryDate"
                                   class="form-label required">{% trans 'Estimated Delivery Date' %}</label>
                            <div class="input-affix-wrapper">
                                <input type="text" name="estimated_delivery_date" id="inputDeliveryDate"
                                       class="form-control date-picker text-black" autocomplete="off" required>
                                <span class="input-suffix">
                                    <i class="fas fa-calendar-alt"></i>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-md-6 col-lg-6">
                        <div class="form-group">
                            <label for="inputActualDate" class="form-label required">{% trans 'Actual Date' %}</label>
                            <div class="input-affix-wrapper">
                                <input type="text" name="actual_delivery_date" id="inputActualDate"
                                       class="form-control date-picker text-black" autocomplete="off" required>
                                <span class="input-suffix">
                                    <i class="fas fa-calendar-alt"></i>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="textareaRemarks" class="form-label">{% trans 'Notes' %}</label>
                    <textarea class="form-control" name="remarks" id="textareaRemarks"></textarea>
                </div>
            </div>
        </div>
        <div class="row mb-3">
            <ul class="nav nav-pills-bfl">
                <li class="nav-item">
                    <a class="nav-link active" data-bs-toggle="tab" href="#tab_detail">
                        <span class="nav-icon-wrap mr-1"><i class="fas fa-cube"></i></span>
                        <span class="nav-link-text">{% trans 'Product' %}</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-bs-toggle="tab" href="#tab_logistics">
                        <span class="nav-icon-wrap mr-1"><i class="fas fa-truck"></i></span>
                        <span class="nav-link-text">{% trans 'Logistics' %}</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-bs-toggle="tab" href="#attachment">
                        <span class="nav-icon-wrap mr-1"><i class="fas fa-paperclip"></i></span>
                        <span class="nav-link-text">{% trans 'Attachment' %}</span>
                    </a>
                </li>
            </ul>
            <div class="tab-content">
                <div class="tab-pane fade show active" id="tab_detail">
                    <table id="dtbPickingProductList"
                           class="table nowrap w-100 mb-5"
                           data-method="GET"
                           data-url="{% url "OrderPickingListAPI" %}"
                           data-url-detail="{% url 'OrderPickingDetail' pk=1 %}">
                        <thead>
                        <tr class="bg-light">
                            <th>#</th>
                            <th>{% trans 'Product' %}
                                <i class="fas fa-info-circle icon-info"
                                   data-bs-toggle="tooltip"
                                   data-bs-placement="bottom"
                                   title="{% trans 'Press row here to open detail page.' %}"></i>
                            </th>
                            <th>{% trans 'Work' %}</th>
                            <th>{% trans 'UOM' %}</th>
                            <th>{% trans 'Total order' %}</th>
                            <th>{% trans 'Delivery before' %}</th>
                            <th>{% trans 'Remain' %}</th>
                            <th>{% trans 'Ready' %}</th>
                            <th class="table-handle-btn">
                            </th>
                        </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
                <div class="tab-pane fade" id="tab_logistics">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <label class="form-label" for="textareaShippingAddress">{% trans 'Shipping Address' %}</label>
                        <span class="pointer logistics-btn"
                              data-is-address="true"
                              data-bs-toggle="modal"
                              data-bs-target="#modal_choise_logistics"
                        ><i class="fa-regular fa-pen-to-square mr-2"></i>{% trans 'Change' %}</span>
                    </div>
                    <textarea class="form-control mb-3 txt-cl-black" name="shipping_address" id="textareaShippingAddress"
                              disabled></textarea>
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <label class="form-label" for="textareaBilling">
                            {% trans 'Billing/Invoice Address' %}
                        </label>
                        <span class="pointer logistics-btn"
                              data-is-invoice="true"
                              data-bs-toggle="modal"
                              data-bs-target="#modal_choise_logistics"
                        ><i class="fa-regular fa-pen-to-square mr-2"></i>{% trans 'Change' %}</span>
                    </div>
                    <textarea class="form-control txt-cl-black" name="billing_address" id="textareaBilling"
                              disabled></textarea>
                </div>
                <div class="tab-pane fade" id="attachment" data-zone="attachments">
                    {% include 'extends/files/all.html' %}
                </div>
            </div>
        </div>


        <div class="offcanvas offcanvas-end w-95" tabindex="-1" id="warehouseStockCanvas" aria-labelledby="offcanvasTopLabel">
            <div class="modal-header">
                <h5><b class="title-mdl"></b></h5>
                <button type="button" class="btn btn-icon btn-rounded btn-flush-light flush-soft-hover btn-lg" data-bs-dismiss="offcanvas"><span class="icon"><i class="far fa-window-close"></i></span></button>
            </div>
            <div class="offcanvas-body">
                <div class="row">
                    <div class="col-12 col-md-6 col-lg-6 border-right">
                        <div id="scroll-new-leased-product">
                            <table id="productNew" class="table w-100">
                                <thead>
                                <tr class="bg-light">
                                    <th>{% trans 'Name' %}</th>
                                    <th>{% trans 'Code' %}</th>
                                    <th>{% trans 'Remain' %}</th>
                                    <th>{% trans 'Deliver' %}</th>
                                </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                    <div class="col-12 col-md-6 col-lg-6">
                        <div id="scroll-table-wh">
                            <table id="productStockDetail" class="table w-100">
                                <thead>
                                <tr class="bg-light">
                                    <th>{% trans 'Warehouse name' %}</th>
                                    <th>{% trans 'Warehouse code' %}</th>
                                    <th>{% trans 'UOM' %}</th>
                                    <th>{% trans 'Stock' %}</th>
                                    <th>{% trans 'Deliver' %}</th>
                                </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                        <div id="scroll-table-lot" hidden>
                            <table
                                id="datable-delivery-wh-lot"
                                class="table nowrap w-100"
                                data-url="{% url "WarehouseLotListAPI" %}"
                                data-url-regis="{% url "GReItemProductWarehouseLotListAPI" %}"
                                data-method="GET"
                            >
                                <thead>
                                <tr class="bg-light">
                                    <th>{% trans 'Lot number' %}</th>
                                    <th>{% trans 'Quantity' %}</th>
                                    <th>{% trans 'Exp date' %}</th>
                                    <th>{% trans 'Mfg date' %}</th>
                                    <th>{% trans 'Deliver' %}</th>
                                </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                        <div id="scroll-table-serial" hidden>
                            <table
                                id="datable-delivery-wh-serial"
                                class="table nowrap w-100"
                                data-url="{% url "WarehouseSerialListAPI" %}"
                                data-url-regis="{% url "GReItemProductWarehouseSerialListAPI" %}"
                                data-method="GET"
                            >
                                <thead>
                                <tr class="bg-light">
                                    <th>
                                        <div class="form-check form-check-lg">
                                            <input
                                                type="checkbox"
                                                name="row-checkbox"
                                                class="form-check-input table-row-checkbox-all"
                                            >
                                            <label class="form-check-label" for="checkbox-all-serial"></label>
                                        </div>
                                    </th>
                                    <th>{% trans 'Vendor serial no.' %}</th>
                                    <th>{% trans 'Serial no.' %}</th>
                                    <th>{% trans 'Warranty start' %}</th>
                                    <th>{% trans 'Warranty end' %}</th>
                                </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary mr-2" data-bs-dismiss="offcanvas">{% trans 'Close' %}</button>
                <button type="button" class="btn btn-primary" id="save-stock" data-bs-dismiss="offcanvas">{% trans 'Get' %}</button>
            </div>
        </div>

        <div class="modal fade" id="modal_choise_logistics">
            <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">{% trans 'Address delivery' %}</h5>
                    </div>
                    <div class="modal-body position-relative">
                        <div class="position-absolute top-50 w-100 text-center opacity-50 translate-middle-y left-0">
                            <div class="spinner-border " role="status">
                                <span class="sr-only">Loading...</span>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{% trans 'Close' %}</button>
                    </div>
                </div>
            </div>
        </div>
    </form>
{% endblock %}

{% block dataHiddenGroup %}
    {{ data.state_choices|json_script:"dataStateChoices" }}
    <input type="hidden" id="trans-factory"
           data-error-picked-quantity="{% trans 'Number is larger than Remain number' %}"
           data-error-warehouse="{% trans 'Warehouse is required!' %}"
           data-error-done="{% trans 'Done column of line detail is empty!' %}"
           data-state-warning="{% trans 'Wait' %}"
           data-state-info="{% trans 'Ready' %}"
           data-state-success="{% trans 'Done' %}"
           data-outstock="{% trans 'Out of stock' %}"
           data-select_address="{% trans 'Select this address' %}"
           data-valid-delivery-amount="{% trans 'Exceed quantity' %}"
           data-exceed-available-quantity="{% trans 'Exceed quantity' %}"
           data-exceed-undelivered-quantity="{% trans 'Exceed quantity' %}"
           data-picked-ready="{% trans 'Picked' %}"
           data-available="{% trans 'Available' %}"
           data-title-mdl="{% trans 'Deliver product' %}"
           data-common-wh="{% trans 'Common warehouse' %}"
           data-current-order="{% trans 'Current order' %}"
           data-other-order="{% trans 'Other order' %}"
           data-new-products="{% trans 'New products' %}"
           data-leased-products="{% trans 'Leased products' %}"
           data-serial-selected="{% trans 'Serial is selected in other row. Please select another' %}"
    >
    <input type="hidden" id="url-factory"
           data-prod-detail="{% url 'ProductDetail' 1 %}"
           data-customer="{% url 'AccountDetail' 1 %}"
           data-customer-detail="{% url 'AccountDetailAPI' 1 %}"
           data-contact="{% url 'ContactDetail' 1 %}"
           data-warehouse-prod="{% url 'WarehouseProductAPI' %}"
           data-product-warehouse="{% url 'WarehouseGetProductsListAPI' %}"
           data-product-regis="{% url 'GoodsRegisBorrowListAPI' %}"

           data-md-product="{% url 'ProductForSaleListAPI' %}"
    >
    <script id="request-data" type="application/json"></script>
    <div class="html-table-title">
    <div class="case-01">
        <button type="button" class="btn btn-soft-success" id="config-one-all">{% trans 'Done' %}</button>
    </div>
    <div class="case-02">
        <button type="button" class="btn btn-soft-success" disabled id="config-three-all">{% trans 'Done' %}</button>
    </div>
    <div class="case-03">
        <span>{% trans 'Done' %}</span>
    </div>
    </div>

    {{ data.employee_current|json_script:'employee_current' }}
{% endblock %}

{% block jsFooter %}
    <script src="{% static 'vendors/daterangepicker/daterangepicker.js' %}"></script>
    <script src="{% static 'vendors/select2/dist/js/select2.full.min.js' %}"></script>
    <script src="{% static 'vendors/select2/dist/js/init-select2.js' %}"></script>
    <script src="{% static 'vendors/flatpickr/flatpickr.min.js' %}"></script>
    {% if base.language == 'vi' %}
        <script src="{% static 'vendors/flatpickr/i18n/vn.js' %}"></script>
    {% endif %}

    <script src="{% static 'assets/js/extends/depreciation/depreciation_common.js' %}"></script>
    <script src="{% static 'sales/delivery/delivery/detail.js' %}"></script>
{% endblock %}

