{% load i18n %}

<div class="form-group text-center">
    <h4 id="header-title" class="text-primary" style="font-weight: bolder"></h4>
</div>

<div class="row bg-light-5 border rounded pr-2 pl-2 pb-2 pt-2">
    <div class="row text-right mb-3">
        <div class="col-6 text-left">
            <a href="#" id="btn-auto-update-stage" class="badge badge-primary">
                <i class="fas fa-sync-alt"></i> {% trans "Auto Update Stage" %}
            </a>
        </div>
        <div class="col-6 text-right">
            <a href="#"><i class="bi bi-bar-chart-line-fill"></i></a>
        </div>
    </div>
    <!-- Status -->
    <div class="d-flex" id="div-stage" data-method="GET" data-url="{% url "OpportunityConfigStageListAPI" %}"></div>
    <div id="stage-hidden" class="hidden">
        <div class="border rounded pr-2 sub-stage w-100 text-center d-flex justify-content-center" style="flex-direction: column;">
            <p class="stage-indicator" style="margin-bottom: auto;"></p>
            <div class="dropdown dropup" style="margin-top: auto;">
                <a href="#" data-bs-toggle="dropdown">
                    <span class="text-right">
                        <i class="bi bi-chevron-bar-right"></i>
                    </span>
                </a>
                <div class="dropdown-menu position-absolute" style="z-index: 999;">
                    <a class="dropdown-item btn-go-to-stage" href="#">{% trans "Go to Stage" %}</a>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row bg-light-5 pr-2 pl-2 pb-2 pt-2 mt-5">
    <div class="col-12 w-100">
        <div class="row div-action">
            <div class="col-11">
                <h4 class="text-primary">{% trans 'Current action' %}</h4>
            </div>
            <div class="col-1 text-right">
                <a href="#" id="btn-show-activity">
                    <span data-bs-toggle="tooltip" data-bs-placement="top" data-bs-original-title="{% trans 'Show activity logs' %}">
                        <i class="bi bi-clock-history text-primary"></i>
                    </span>
                </a>
            </div>
        </div>
        <div class="row div-activity hidden">
            <div class="col-11 d-flex">
                <h4 class="text-primary">{% trans "Activity logs" %}</h4>
                <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <div class="dropdown">
                    <button type="button" class="btn btn-soft-primary btn-xs dropdown-toggle" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="bi bi-ui-checks-grid"></i> {% trans 'New Log' %}
                    </button>
                    <div class="dropdown-menu">
                        <a data-bs-toggle="modal" data-bs-target="#create-new-call-log" class="dropdown-item create-new-call-log-button" href="#">
                            {% trans 'Log a call' %}
                        </a>
                        <a data-bs-toggle="modal" data-bs-target="#send-email" class="dropdown-item send-email-button" href="#">
                            {% trans 'Email' %}
                        </a>
                        <a data-bs-toggle="modal" data-bs-target="#create-meeting" class="dropdown-item new-meeting-button" href="#">
                            {% trans 'Meeting' %}
                        </a>
                        <a data-drawer-target="#drawer_task_create" data-drawer-active="false" class="dropdown-item ntt-drawer-toggle-link current-create-task" href="#">
                            {% trans 'Task' %}
                        </a>
                    </div>
                </div>
                <div class="dropdown">
                    <button type="button" class="btn btn-soft-primary btn-xs dropdown-toggle ml-2" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false" data-bs-toggle="dropdown">
                        <i class="fa-solid fa-arrows-spin"></i> {% trans 'Create Related Feature' %}
                    </button>
                    <div class="dropdown-menu">
                        <a class="dropdown-item btn-create-related-feature" data-url="{% url 'QuotationCreate' %}" href="#">{% trans 'Quotation' %}</a>
                        <a class="dropdown-item btn-create-related-feature" data-url="{% url 'SaleOrderCreate' %}" href="#">{% trans 'Sale Order' %}</a>
                        <a class="dropdown-item btn-create-related-feature" data-url="{% url 'AdvancePaymentCreate' %}" href="#">{% trans 'Advance Payment' %}</a>
                        <a class="dropdown-item btn-create-related-feature" data-url="{% url 'PaymentCreate' %}" href="#">{% trans 'Payment' %}</a>
                        <a class="dropdown-item btn-create-related-feature" data-url="{% url 'ReturnAdvanceCreate' %}" href="#">{% trans 'Return advance' %}</a>
                    </div>
                </div>
                <div class="dropdown">
                    <button type="button" class="btn btn-soft-secondary btn-xs dropdown-toggle ml-2" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false" data-bs-toggle="dropdown">
                        <i class="bi bi-box-arrow-up-right"></i> {% trans 'View Related Feature' %}
                    </button>
                    <div class="dropdown-menu">
                        <a class="dropdown-item item-detail-related-feature" id="item-related-quotation" href="#" target="_blank">{% trans 'Quotation' %}</a>
                        <a class="dropdown-item item-detail-related-feature" id="item-related-sale-order" href="#" target="_blank">{% trans 'Sale Order' %}</a>
                    </div>
                </div>
            </div>
            <div class="col-1 text-right">
                <a href="#" id="btn-show-action">
                    <span data-bs-toggle="tooltip" data-bs-placement="top" data-bs-original-title="{% trans 'Show actions' %}">
                        <i class="bi bi-pip text-primary"></i>
                    </span>
                </a>
            </div>
        </div>
    </div>
    <div class="w-100 div-action">
        <div class="row">
            <div class="h-150p">
                <div class="bg-blue-light-4 border rounded-5 mt-1 mb-1 h-90">
                    <div class="row mt-2 ml-2 mr-2">
                        <div class="col-10">
                            <span class="text-black">{% trans "(Current action title)" %}</span>
                        </div>
                        <div class="col-2 text-right">
                            <a href="#" class="badge badge-primary w-50">{% trans 'Do' %}</a>
                        </div>
                    </div>
                    <div class="row mt-2 mr-2">
                        <div class="col-10"></div>
                        <div class="col-2 text-right">
                            <a href="#" class="badge badge-orange w-50">{% trans 'Skip' %}</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-12">
        <div class="row div-action">
            <div class="col-6">
                <h5 class="text-primary">{% trans 'Next action' %}</h5>
            </div>
        </div>
    </div>
    <div class="w-100 div-action">
        <div class="row">
            <div class="col-6">
                <div class="h-150p">
                    <div class="bg-green-light-5 border rounded-5 mt-1 mb-1 h-90">
                        <div class="row mt-2 ml-2 mr-2">
                            <div class="col-10">
                                <span class="text-black">{% trans "(Next action title 1)" %}</span>
                            </div>
                            <div class="col-2 text-right">
                                <a href="#" class="badge badge-secondary w-100">{% trans 'Do' %}</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-6">
                <div class="h-150p">
                    <div class="bg-green-light-5 border rounded-5 mt-1 mb-1 h-90">
                        <div class="row mt-2 ml-2 mr-2">
                            <div class="col-10">
                                <span class="text-black">{% trans "(Next action title 2)" %}</span>
                            </div>
                            <div class="col-2 text-right">
                                <a href="#" class="badge badge-secondary w-100">{% trans 'Do' %}</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-12 w-100 hidden div-activity border rounded pr-2 pl-2 pb-2 pt-2">
        <div class="row mb-2">
            <div class="col-12">
                <table class="table nowrap w-100" id="table-timeline"
                       data-url-logs_list="{% url 'OpportunityActivityLogListAPI' %}"
                       data-url-delete-call-log="{% url 'OpportunityCallLogDeleteAPI' '0' %}"
                       data-url-delete-email="{% url 'OpportunityEmailDeleteAPI' '0' %}"
                       data-url-delete-meeting="{% url 'OpportunityMeetingDeleteAPI' '0' %}"
                       data-method="GET">
                    <thead>
                    <tr>
                        <th>{% trans "Activity" %}</th>
                        <th>{% trans 'Subject' %}
                            <i class="fas fa-info-circle icon-info"
                               data-bs-toggle="tooltip"
                               data-bs-placement="bottom"
                               title="{% trans 'Press row here to see detail.' %}">
                            </i>
                        </th>
                        <th>{% trans "Date" %}</th>
                        <th></th>
                    </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div class="row bg-light-5 pr-2 pl-2 pb-2 pt-2 mt-5">
    <div class="col-12 mt-2">
        <ul class="nav nav-light nav-tabs col-12" id="tab-select">
            <li class="nav-item">
                <a class="nav-link active" data-bs-toggle="tab" href="#tab_product">
                    <span class="nav-link-text">{% trans 'Product' %}</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#tab_competitors">
                    <span class="nav-link-text">{% trans 'Competitors' %}</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#tab_contact_role">
                    <span class="nav-link-text">{% trans 'Contact Role' %}</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#tab_account_history">
                    <span class="nav-link-text">{% trans 'Account History' %}</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#tab_team">
                    <span class="nav-link-text">{% trans 'Team' %}</span>
                </a>
            </li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane fade show active" id="tab_product">
                <div class="dropdown">
                    <button type="button" data-bs-toggle="dropdown" class="btn btn-link btn-animated">
                        <span>
                            <span class="icon">
                                <span class="feather-icon">
                                    <i data-feather="plus"></i>
                                </span>
                            </span>
                            <span>{% trans 'Add Product' %}</span>
                        </span>
                    </button>
                    <div class="dropdown-menu">
                        <a class="dropdown-item" href="#" id="btn-add-select-product">{% trans 'Select Product' %}</a>
                        <a class="dropdown-item" href="#" id="btn-add-input-product">{% trans 'Input Product' %}</a>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <div class="table-responsive">
                            <table class="table w-100 nowrap" id="table-products">
                                <thead>
                                <tr>
                                    <th class=""></th>
                                    <th>{% trans "Product" %}</th>
                                    <th>{% trans 'Product Category' %}</th>
                                    <th>{% trans 'UoM' %}</th>
                                    <th>{% trans "Quantity" %}</th>
                                    <th>{% trans "Unit Price" %}</th>
                                    <th>{% trans "Tax" %}</th>
                                    <th>{% trans "Subtotal Price" %}</th>
                                    <th></th>
                                </tr>
                                </thead>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-6 dropdown"></div>
                    <div class="col-6 mt-5 border rounded pr-2 pl-2 pb-2 pt-2">
                        <div class="row mb-2">
                            <div class="col-6"><p>{% trans 'Pretax Amount' %}</p></div>
                            <div class="col-6 readonly">
                                <input id="input-product-pretax-amount" type="text" class="form-control mask-money" data-return-type="number" readonly>
                            </div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-6"><p>{% trans 'Taxes' %}</p></div>
                            <div class="col-6 readonly">
                                <input id="input-product-taxes" type="text" class="form-control mask-money" data-return-type="number" readonly>
                            </div>
                        </div>
                        <div class="dropdown-divider"></div>
                        <div class="row mb-2">
                            <div class="col-6"><b>{% trans 'Total' %}</b></div>
                            <div class="col-6 readonly">
                                <input id="input-product-total" type="text" class="form-control mask-money" data-return-type="number" readonly>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-pane fade mb-25" id="tab_competitors">
                <button type="button" class="btn btn-link btn-animated" id="btn-add-competitor">
                    <span>
                        <span class="icon">
                            <span class="feather-icon">
                                <i data-feather="plus"></i>
                            </span>
                        </span>
                        <span>{% trans 'Add Competitor' %}</span>
                    </span>
                </button>
                <table class="table nowrap w-100" id="table-competitors">
                    <thead>
                    <tr>
                        <th class="wrap-text w-30">{% trans "Name" %}</th>
                        <th class="wrap-text w-30">{% trans 'Strength' %}</th>
                        <th class="wrap-text w-30">{% trans 'Weakness' %}</th>
                        <th class="wrap-text w-10">{% trans "Win deal" %}</th>
                        <th></th>
                    </tr>
                    </thead>
                </table>
            </div>
            <div class="tab-pane fade mb-25" id="tab_contact_role">
                <button type="button" class="btn btn-link btn-animated" id="btn-add-contact">
                    <span>
                        <span class="icon">
                            <span class="feather-icon">
                                <i data-feather="plus"></i>
                            </span>
                        </span>
                        <span>{% trans 'Add Contact' %}</span>
                    </span>
                </button>
                <table class="table nowrap w-100" id="table-contact-role">
                    <thead>
                    <tr>
                        <th>{% trans "Which Customer" %}</th>
                        <th>{% trans 'Name' %}</th>
                        <th>{% trans 'Job title' %}</th>
                        <th>{% trans "Role" %}</th>
                        <th></th>
                    </tr>
                    </thead>
                </table>
                <div class="form-group mt-5">
                    <label class="form-label" for="box-select-factor">{% trans "Select Reason why customer buy your product" %}</label>
                    <select class="form-select" multiple id="box-select-factor" data-method="GET" data-url="{% url 'OpportunityCustomerDecisionFactorListAPI' %}" data-keyResp="opportunity_decision_factor"></select>
                </div>
            </div>
            <div class="tab-pane fade mb-25" id="tab_account_history">
                <div class="d-flex overflow-auto">

                </div>
            </div>
            <div class="tab-pane fade mb-25" id="tab_team">
                <div class="row mb-3">
                    <div class="col-12 shadow shadow-bottom shadow-left border rounded p-5">
                        <div class="row" id="member-item-list">
                            <div class="member-item col-12 col-lg-4 col-md-6 text-center">
                                <button data-id="new" type="button" class="btn btn-link btn-animated" data-bs-toggle="modal" data-bs-target="#modalAddMember" id="btn-show-modal-add-member">
                                    <span>
                                        <span class="icon">
                                            <span class="feather-icon">
                                                <i data-feather="plus"></i>
                                            </span>
                                        </span>
                                        <span>{% trans 'Add Member' %}</span>
                                    </span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-12 shadow shadow-bottom shadow-left border rounded p-5 hidden" id="box-edit-permit"
                         data-url="{% url 'MemberOfOpportunityDetail' pk_opp=pk pk_member='__pk_member__' %}" data-id="">
                        <div class="row mb-2">
                            <div class="col-12 col-md-6 col-lg-6 col-xl-6 mb-1">
                                <div class="form-group">
                                    <label for="member-current-edit" class="form-label">{% trans 'Member' %}</label>
                                    <select name="" id="member-current-edit" class="form-select">
                                        <option value="" selected></option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-12 col-md-6 col-lg-6 col-xl-6 mb-1">
                                <div class="form-group">
                                    <div class="form-label">{% trans 'Actions' %}</div>
                                    <button class="btn btn-primary text-white form-control" type="button" id="btnSavePermitMember">{% trans 'Save' %}</button>
                                </div>
                            </div>
                            <div class="col-12 mb-1">
                                <div class="row">
                                    <div class="col-12 col-md-6 col-lg-6 col-xl-3 mb-1">
                                        <div class="form-check form-switch">
                                            <input type="checkbox" class="form-check-input" id="enable-view-opp-member">
                                            <label class="form-check-label" for="enable-view-opp-member">
                                                {% trans 'Allow view member' %}
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-12 col-md-6 col-lg-6 col-xl-3 mb-1">
                                        <div class="form-check form-switch">
                                            <input type="checkbox" class="form-check-input" id="enable-add-opp-member">
                                            <label class="form-check-label" for="enable-add-opp-member">
                                                {% trans 'Allow add member' %}
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row mb-2">
                            <div class="separator separator-light m-0"></div>
                        </div>
                        <div class="row mb-2">
                            {% include 'core/hr/extends_new/permission_group_tabs_has_change_app.html' with range_allowed="1,4" pk='__pk__' get_from='opportunity' active_tab='tab-permissions' actions_enabled=True permit_enabled=True %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row bg-light-5 pr-2 pl-2 pb-2 pt-2 mt-10 mb-20">
    <div class="col-2 bg-danger-light-4 border rounded justify-content-end">
        <div class="form-check">
            <input type="checkbox" class="form-check-input" id="check-lost-reason">
            <label class="form-check-label" for="check-lost-reason">{% trans "Lost by other reason" %}</label>
        </div>
    </div>
</div>